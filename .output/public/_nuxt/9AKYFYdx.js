import{d as j,l as V,q as S,r as g,E as L,c,v as B,b as e,t as y,s as C,x as v,g as $,y as w,e as l,J as U,a as u,j as E,o as q,k as D,F as H,i as N,n as P,M as F}from"./B_rLn4hw.js";const O={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},R={class:"flex items-center justify-between mb-6"},I={class:"text-2xl font-bold"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},K={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},Q={class:"flex justify-end space-x-3 pt-4"},W=["disabled"],X={key:0},Y={key:1},Z=j({__name:"GradeLevelModal",props:{show:{type:Boolean},gradeLevel:{default:null}},emits:["close","saved"],setup(k,{emit:_}){const x=k,f=_,b=E(),{accessToken:m}=V(),s=S({code:"",name:"",level_type:"elementary",grade_number:1,display_order:0}),p=g(!1),a=g("");L(()=>x.gradeLevel,r=>{r?(s.code=r.code,s.name=r.name,s.level_type=r.level_type,s.grade_number=r.grade_number,s.display_order=r.display_order):(s.code="",s.name="",s.level_type="elementary",s.grade_number=1,s.display_order=0),a.value=""},{immediate:!0});const h=async()=>{p.value=!0,a.value="";try{const r={code:s.code,name:s.name,level_type:s.level_type,grade_number:s.grade_number,display_order:s.display_order};x.gradeLevel?await $fetch(`${b.public.apiBase}/admin/settings/grade-levels/${x.gradeLevel.id}`,{method:"PUT",headers:{Authorization:`Bearer ${m.value}`},body:r}):await $fetch(`${b.public.apiBase}/admin/settings/grade-levels`,{method:"POST",headers:{Authorization:`Bearer ${m.value}`},body:r}),f("saved"),f("close")}catch(r){console.error("Error saving grade level:",r),a.value=r.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{p.value=!1}};return(r,t)=>k.show?(u(),c("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[7]||(t[7]=C(d=>r.$emit("close"),["self"]))},[e("div",O,[e("div",R,[e("h2",I,y(k.gradeLevel?"แก้ไขระดับชั้น":"เพิ่มระดับชั้น"),1),e("button",{onClick:t[0]||(t[0]=d=>r.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...t[8]||(t[8]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:C(h,["prevent"]),class:"space-y-4"},[e("div",J,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" รหัส "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>l(s).code=d),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,l(s).code]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" ชื่อ "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=d=>l(s).name=d),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,l(s).name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" ประเภท "),e("span",{class:"text-red-500"},"*")],-1)),v(e("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>l(s).level_type=d),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...t[11]||(t[11]=[e("option",{value:"elementary"},"ประถมศึกษา",-1),e("option",{value:"secondary"},"มัธยมศึกษา",-1)])],512),[[U,l(s).level_type]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" ระดับชั้น "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>l(s).grade_number=d),type:"number",min:"1",max:"6",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,l(s).grade_number,void 0,{number:!0}]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ลำดับการแสดง ",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>l(s).display_order=d),type:"number",min:"0",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,l(s).display_order,void 0,{number:!0}]])])]),l(a)?(u(),c("div",K,y(l(a)),1)):B("",!0),e("div",Q,[e("button",{type:"button",onClick:t[6]||(t[6]=d=>r.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:l(p),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[l(p)?(u(),c("span",X,"กำลังบันทึก...")):(u(),c("span",Y,"บันทึก"))],8,W)])],32)])])):B("",!0)}}),ee=Object.assign(Z,{__name:"GradeLevelModal"}),te={class:"flex items-center justify-between mb-6"},se={class:"bg-white rounded-lg shadow p-4 mb-6"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"bg-white rounded-lg shadow overflow-hidden"},re={key:0,class:"p-8 text-center"},ne={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},ae={key:2,class:"p-8 text-center text-gray-500"},de={key:3,class:"min-w-full divide-y divide-gray-200"},ie={class:"bg-white divide-y divide-gray-200"},ue={class:"px-6 py-4 whitespace-nowrap"},ce={class:"text-sm font-medium text-gray-900"},pe={class:"px-6 py-4 whitespace-nowrap"},me={class:"text-sm text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ve={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},xe={class:"flex items-center justify-end space-x-2"},fe=["onClick"],be=["onClick"],we=j({__name:"index",setup(k){const _=E(),{accessToken:x}=V(),f=g([]),b=g(!1),m=g(""),s=g(!1),p=g(null),a=S({search:"",level_type:""});let h=null;const r=()=>{h&&clearTimeout(h),h=setTimeout(()=>{t()},500)},t=async()=>{b.value=!0,m.value="";try{const i=new URLSearchParams;a.search&&i.append("search",a.search),a.level_type&&i.append("level_type",a.level_type);const o=await $fetch(`${_.public.apiBase}/admin/settings/grade-levels?${i.toString()}`,{headers:{Authorization:`Bearer ${x.value}`}});o.success&&(f.value=o.data)}catch(i){console.error("Error loading grade levels:",i),m.value=i.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{b.value=!1}},d=i=>{p.value={...i},s.value=!1},M=()=>{s.value=!1,p.value=null},z=()=>{M(),t()},G=async i=>{const{confirm:o}=F();if(await o({title:"ยืนยันการลบ",message:`คุณแน่ใจหรือไม่ว่าต้องการลบระดับชั้น ${i.name}?
การกระทำนี้ไม่สามารถยกเลิกได้`,confirmText:"ลบ",cancelText:"ยกเลิก",type:"danger"}))try{await $fetch(`${_.public.apiBase}/admin/settings/grade-levels/${i.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${x.value}`}}),await t()}catch(n){console.error("Error deleting grade level:",n),alert(n.data?.message||"เกิดข้อผิดพลาดในการลบระดับชั้น")}};return q(()=>{t()}),(i,o)=>{const T=ee;return u(),c("div",null,[e("div",te,[o[4]||(o[4]=e("h1",{class:"text-3xl font-bold"},"จัดการระดับชั้น",-1)),e("button",{onClick:o[0]||(o[0]=n=>s.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...o[3]||(o[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มระดับชั้น",-1)])])]),e("div",se,[e("div",oe,[e("div",null,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),v(e("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>l(a).search=n),type:"text",placeholder:"ค้นหาด้วยชื่อ, รหัส",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:r},null,544),[[w,l(a).search]])]),e("div",null,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ประเภท",-1)),v(e("select",{"onUpdate:modelValue":o[2]||(o[2]=n=>l(a).level_type=n),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:t},[...o[6]||(o[6]=[e("option",{value:""},"ทั้งหมด",-1),e("option",{value:"elementary"},"ประถมศึกษา",-1),e("option",{value:"secondary"},"มัธยมศึกษา",-1)])],544),[[U,l(a).level_type]])])])]),e("div",le,[l(b)?(u(),c("div",re,[...o[8]||(o[8]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):l(m)?(u(),c("div",ne,y(l(m)),1)):l(f).length===0?(u(),c("div",ae," ไม่พบระดับชั้น ")):(u(),c("table",de,[o[11]||(o[11]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"รหัส"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ชื่อ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ประเภท"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ลำดับ"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",ie,[(u(!0),c(H,null,N(l(f),n=>(u(),c("tr",{key:n.id,class:"hover:bg-gray-50"},[e("td",ue,[e("div",ce,y(n.code),1)]),e("td",pe,[e("div",me,y(n.name),1)]),e("td",ge,[e("span",{class:P(["px-2 py-1 text-xs font-medium rounded",n.level_type==="elementary"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"])},y(n.level_type==="elementary"?"ประถมศึกษา":"มัธยมศึกษา"),3)]),e("td",ye,y(n.display_order||0),1),e("td",ve,[e("div",xe,[e("button",{onClick:C(A=>d(n),["stop"]),class:"text-blue-600 hover:text-blue-900",title:"แก้ไข"},[...o[9]||(o[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,fe),e("button",{onClick:C(A=>G(n),["stop"]),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...o[10]||(o[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,be)])])]))),128))])]))]),l(s)||l(p)?(u(),D(T,{key:0,show:l(s)||!!l(p),"grade-level":l(p),onClose:M,onSaved:z},null,8,["show","grade-level"])):B("",!0)])}}});export{we as default};
