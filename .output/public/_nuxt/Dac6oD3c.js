import{d as x,l as v,r as _,q as w,B as h,E as k,c as d,b as a,s as M,x as i,L as T,e as s,y as m,H as V,v as B,g as U,a as c}from"./CX4WDIMJ.js";const A={class:"space-y-6"},E={class:"bg-white rounded-lg shadow p-6"},P={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},j={class:"relative inline-flex items-center cursor-pointer"},C={class:"flex justify-end pt-4"},I=["disabled"],N={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},q=x({__name:"MaintenanceTab",props:{settings:{}},emits:["saved"],setup(u,{emit:f}){const p=u,g=f,{accessToken:b}=v(),o=_(!1),n=w({maintenance_mode:!1,maintenance_message:"",maintenance_allowed_ips:[]}),r=h({get:()=>n.maintenance_allowed_ips.join(", "),set:t=>{n.maintenance_allowed_ips=t.split(",").map(e=>e.trim()).filter(e=>e.length>0)}});k(()=>p.settings,t=>{t&&t.length>0&&t.forEach(e=>{e.key==="maintenance_mode"?n.maintenance_mode=e.value||!1:e.key==="maintenance_message"?n.maintenance_message=e.value||"":e.key==="maintenance_allowed_ips"&&(n.maintenance_allowed_ips=Array.isArray(e.value)?e.value:[])})},{immediate:!0});const y=async()=>{try{o.value=!0;const t=[{key:"maintenance_mode",value:n.maintenance_mode},{key:"maintenance_message",value:n.maintenance_message},{key:"maintenance_allowed_ips",value:n.maintenance_allowed_ips}];await $fetch("/api/admin/settings/system",{method:"PUT",headers:{Authorization:`Bearer ${b.value}`},body:{settings:t}}),g("saved")}catch(t){console.error("Error saving maintenance settings:",t),alert(t.data?.message||"เกิดข้อผิดพลาดในการบันทึกการตั้งค่า")}finally{o.value=!1}};return(t,e)=>(c(),d("div",A,[a("div",E,[e[9]||(e[9]=a("h2",{class:"text-xl font-semibold mb-4"},"การตั้งค่า Maintenance Mode",-1)),a("form",{onSubmit:M(y,["prevent"]),class:"space-y-4"},[a("div",P,[e[4]||(e[4]=a("div",null,[a("label",{class:"block text-sm font-medium text-gray-700"}," เปิดใช้งาน Maintenance Mode "),a("p",{class:"text-sm text-gray-500 mt-1"}," เมื่อเปิดใช้งาน ผู้ใช้ทั่วไปจะเห็นหน้า Maintenance แทนหน้าเว็บปกติ ")],-1)),a("label",j,[i(a("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s(n).maintenance_mode=l),type:"checkbox",class:"sr-only peer"},null,512),[[T,s(n).maintenance_mode]]),e[3]||(e[3]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"},null,-1))])]),a("div",null,[e[5]||(e[5]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ข้อความ Maintenance ",-1)),i(a("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>s(n).maintenance_message=l),rows:"4",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"ระบบกำลังบำรุงรักษา กรุณาลองใหม่อีกครั้งในภายหลัง"},null,512),[[m,s(n).maintenance_message]])]),a("div",null,[e[6]||(e[6]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," IP ที่สามารถเข้าถึงได้ระหว่าง Maintenance (คั่นด้วย comma) ",-1)),i(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>V(r)?r.value=l:null),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"127.0.0.1, 192.168.1.1"},null,512),[[m,s(r)]]),e[7]||(e[7]=a("p",{class:"mt-1 text-sm text-gray-500"}," IP ที่ระบุจะสามารถเข้าถึงระบบได้ปกติแม้จะเปิด Maintenance Mode ",-1))]),a("div",C,[a("button",{type:"submit",disabled:s(o),class:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[s(o)?(c(),d("span",N)):B("",!0),e[8]||(e[8]=U(" บันทึก ",-1))],8,I)])],32)])]))}});export{q as _};
