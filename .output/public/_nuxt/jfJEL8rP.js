import{d as Y,m as Z,p as ee,l as te,r as d,q as H,o as se,c as r,b as e,v as f,e as l,t as u,s as P,x as m,g as v,y as p,J as T,F as R,i as N,H as I,j as le,a}from"./CX4WDIMJ.js";const ne={class:"flex items-center justify-between mb-6"},oe={class:"flex items-center space-x-4"},re={key:0,class:"text-center py-12"},ae={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6"},ie={key:2,class:"space-y-6"},de={class:"bg-white rounded-lg shadow p-6"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},me={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},pe={class:"flex justify-end space-x-3 pt-4"},ge=["disabled"],be={key:0},ce={key:1},fe={class:"bg-white rounded-lg shadow p-6"},ve={class:"flex items-center justify-between mb-6"},ye={key:0,class:"space-y-4"},xe={class:"flex items-center justify-between"},he={class:"flex-1"},ke={class:"flex items-center space-x-3 mb-2"},we={class:"text-lg font-medium text-gray-900"},$e={class:"px-2 py-1 text-xs font-medium rounded bg-blue-100 text-blue-800"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Be={class:"ml-2 text-gray-900"},Ce={class:"ml-2 text-gray-900"},Pe={class:"flex items-center space-x-2"},Ue=["onClick"],Ve={key:1,class:"text-center py-8 text-gray-500"},Ee={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Me={key:0,class:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg"},Ae=["onClick"],je={class:"font-medium"},ze={class:"text-sm text-gray-500"},Se={key:0},Te={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},qe={class:"flex justify-end space-x-3 pt-4"},He=["disabled"],Re={key:0},Ne={key:1},Ie={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Fe={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},De={class:"flex justify-end space-x-3 pt-4"},Le=["disabled"],Je={key:0},Oe={key:1},Qe=Y({__name:"edit",setup(Ge){const F=Z(),D=ee(),y=le(),{accessToken:x}=te(),k=parseInt(F.params.id),z=d(!0),U=d(""),b=d(null),_=d([]),V=d(!1),E=d(""),M=d(!1),c=d(""),h=d([]),w=d(null),B=d("guardian"),A=d(!1),$=d(""),g=d(null),j=d(!1),C=d(""),i=H({first_name:"",last_name:"",email:"",phone:"",relationship:"guardian"}),o=H({username:"",email:"",first_name:"",last_name:"",phone:"",status:"active"}),S=async()=>{z.value=!0,U.value="";try{const n=await $fetch(`${y.public.apiBase}/admin/students/${k}`,{headers:{Authorization:`Bearer ${x.value}`}});n.success&&(b.value=n.data.student,_.value=n.data.parents||[],o.username=b.value.username,o.email=b.value.email||"",o.first_name=b.value.first_name,o.last_name=b.value.last_name,o.phone=b.value.phone||"",o.status=b.value.status)}catch(n){console.error("Error loading student:",n),U.value=n.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{z.value=!1}},L=async()=>{V.value=!0,E.value="";try{await $fetch(`${y.public.apiBase}/admin/users/${k}`,{method:"PUT",headers:{Authorization:`Bearer ${x.value}`},body:{email:o.email||null,first_name:o.first_name,last_name:o.last_name,phone:o.phone||null}}),await $fetch(`${y.public.apiBase}/admin/users/${k}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${x.value}`},body:{status:o.status}}),D.push(`/admin/students/${k}`)}catch(n){console.error("Error updating student:",n),E.value=n.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{V.value=!1}},J=async()=>{if(!c.value||c.value.length<2){h.value=[];return}try{const n=await $fetch(`${y.public.apiBase}/admin/users?search=${encodeURIComponent(c.value)}&role=parent&limit=10`,{headers:{Authorization:`Bearer ${x.value}`}});if(n.success){const t=_.value.map(s=>s.id);h.value=n.data.filter(s=>!t.includes(s.id))}}catch(n){console.error("Error searching parent:",n),h.value=[]}},O=n=>{w.value=n,c.value=`${n.first_name} ${n.last_name} (${n.username})`,h.value=[],$.value=""},q=()=>{M.value=!1,w.value=null,c.value="",B.value="guardian",$.value="",h.value=[]},G=async()=>{if(w.value){A.value=!0,$.value="";try{await $fetch(`${y.public.apiBase}/admin/students/${k}/parents`,{method:"POST",headers:{Authorization:`Bearer ${x.value}`},body:{parent_id:w.value.id,relationship:B.value}}),await S(),q()}catch(n){console.error("Error adding parent:",n),$.value=n.data?.message||"เกิดข้อผิดพลาดในการเพิ่มผู้ปกครอง"}finally{A.value=!1}}},K=n=>{g.value=n,i.first_name=n.first_name,i.last_name=n.last_name,i.email=n.email||"",i.phone=n.phone||"",i.relationship=n.relationship||"guardian",C.value=""},Q=async()=>{if(g.value){j.value=!0,C.value="";try{await $fetch(`${y.public.apiBase}/admin/users/${g.value.id}`,{method:"PUT",headers:{Authorization:`Bearer ${x.value}`},body:{email:i.email||null,first_name:i.first_name,last_name:i.last_name,phone:i.phone||null}}),i.relationship!==g.value.relationship&&await $fetch(`${y.public.apiBase}/admin/students/${k}/parents/${g.value.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${x.value}`},body:{relationship:i.relationship}}),await S(),g.value=null}catch(n){console.error("Error editing parent:",n),C.value=n.data?.message||"เกิดข้อผิดพลาดในการแก้ไขข้อมูลผู้ปกครอง"}finally{j.value=!1}}},W=n=>({father:"บิดา",mother:"มารดา",guardian:"ผู้ปกครอง",other:"อื่นๆ"})[n]||n;return se(()=>{S()}),(n,t)=>(a(),r("div",null,[e("div",ne,[e("div",oe,[e("button",{onClick:t[0]||(t[0]=s=>n.$router.back()),class:"p-2 hover:bg-gray-100 rounded-lg"},[...t[19]||(t[19]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),t[20]||(t[20]=e("h1",{class:"text-3xl font-bold"},"แก้ไขผู้เรียน",-1))])]),l(z)?(a(),r("div",re,[...t[21]||(t[21]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-4 text-gray-600"},"กำลังโหลดข้อมูล...",-1)])])):l(U)?(a(),r("div",ae,u(l(U)),1)):l(b)?(a(),r("div",ie,[e("div",de,[t[30]||(t[30]=e("h2",{class:"text-xl font-semibold mb-6"},"ข้อมูลผู้เรียน",-1)),e("form",{onSubmit:P(L,["prevent"]),class:"space-y-4"},[e("div",ue,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" Username "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l(o).username=s),type:"text",required:"",disabled:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-100 cursor-not-allowed"},null,512),[[p,l(o).username]]),t[23]||(t[23]=e("p",{class:"mt-1 text-xs text-gray-500"},"ไม่สามารถแก้ไข Username ได้",-1))]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email ",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l(o).email=s),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(o).email]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" ชื่อ "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l(o).first_name=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(o).first_name]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" นามสกุล "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l(o).last_name=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(o).last_name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," เบอร์โทรศัพท์ ",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>l(o).phone=s),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(o).phone]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" สถานะ "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>l(o).status=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...t[28]||(t[28]=[e("option",{value:"active"},"ใช้งาน",-1),e("option",{value:"inactive"},"ปิดใช้งาน",-1),e("option",{value:"suspended"},"ระงับ",-1)])],512),[[T,l(o).status]])])]),l(E)?(a(),r("div",me,u(l(E)),1)):f("",!0),e("div",pe,[e("button",{type:"button",onClick:t[7]||(t[7]=s=>n.$router.back()),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:l(V),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[l(V)?(a(),r("span",be,"กำลังบันทึก...")):(a(),r("span",ce,"บันทึก"))],8,ge)])],32)]),e("div",fe,[e("div",ve,[t[32]||(t[32]=e("h2",{class:"text-xl font-semibold"},"ผู้ปกครอง",-1)),e("button",{onClick:t[8]||(t[8]=s=>M.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2"},[...t[31]||(t[31]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มผู้ปกครอง",-1)])])]),l(_)&&l(_).length>0?(a(),r("div",ye,[(a(!0),r(R,null,N(l(_),s=>(a(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4"},[e("div",xe,[e("div",he,[e("div",ke,[e("h3",we,u(s.first_name)+" "+u(s.last_name),1),e("span",$e,u(W(s.relationship)),1)]),e("div",_e,[e("div",null,[t[33]||(t[33]=e("span",{class:"text-gray-500"},"Email:",-1)),e("span",Be,u(s.email||"-"),1)]),e("div",null,[t[34]||(t[34]=e("span",{class:"text-gray-500"},"เบอร์โทรศัพท์:",-1)),e("span",Ce,u(s.phone||"-"),1)])])]),e("div",Pe,[e("button",{onClick:X=>K(s),class:"px-3 py-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"แก้ไขผู้ปกครอง"},[...t[35]||(t[35]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Ue)])])]))),128))])):(a(),r("div",Ve,[...t[36]||(t[36]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})],-1),e("p",{class:"mt-2"},"ไม่มีข้อมูลผู้ปกครอง",-1)])]))])])):f("",!0),l(M)?(a(),r("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[11]||(t[11]=P(s=>M.value=!1,["self"]))},[e("div",Ee,[t[40]||(t[40]=e("h3",{class:"text-lg font-semibold mb-4"},"เพิ่มผู้ปกครอง",-1)),e("form",{onSubmit:P(G,["prevent"]),class:"space-y-4"},[e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ค้นหาผู้ปกครอง (Username หรือ Email) ",-1)),m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>I(c)?c.value=s:null),type:"text",placeholder:"กรอก username หรือ email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:J},null,544),[[p,l(c)]]),l(h).length>0?(a(),r("div",Me,[(a(!0),r(R,null,N(l(h),s=>(a(),r("button",{key:s.id,type:"button",onClick:X=>O(s),class:"w-full text-left px-4 py-2 hover:bg-gray-100 border-b border-gray-100 last:border-b-0"},[e("div",je,u(s.first_name)+" "+u(s.last_name),1),e("div",ze,u(s.username)+" - "+u(s.email||"-"),1)],8,Ae))),128))])):f("",!0)]),l(w)?(a(),r("div",Se,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" ความสัมพันธ์ "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>I(B)?B.value=s:null),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...t[38]||(t[38]=[e("option",{value:"father"},"บิดา",-1),e("option",{value:"mother"},"มารดา",-1),e("option",{value:"guardian"},"ผู้ปกครอง",-1),e("option",{value:"other"},"อื่นๆ",-1)])],512),[[T,l(B)]])])):f("",!0),l($)?(a(),r("div",Te,u(l($)),1)):f("",!0),e("div",qe,[e("button",{type:"button",onClick:q,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:!l(w)||l(A),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[l(A)?(a(),r("span",Re,"กำลังเพิ่ม...")):(a(),r("span",Ne,"เพิ่ม"))],8,He)])],32)])])):f("",!0),l(g)?(a(),r("div",{key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[18]||(t[18]=P(s=>g.value=null,["self"]))},[e("div",Ie,[t[47]||(t[47]=e("h3",{class:"text-lg font-semibold mb-4"},"แก้ไขผู้ปกครอง",-1)),e("form",{onSubmit:P(Q,["prevent"]),class:"space-y-4"},[e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" ชื่อ "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>l(i).first_name=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(i).first_name]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" นามสกุล "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>l(i).last_name=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(i).last_name]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email ",-1)),m(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>l(i).email=s),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(i).email]])]),e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," เบอร์โทรศัพท์ ",-1)),m(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>l(i).phone=s),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[p,l(i).phone]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" ความสัมพันธ์ "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[16]||(t[16]=s=>l(i).relationship=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...t[45]||(t[45]=[e("option",{value:"father"},"บิดา",-1),e("option",{value:"mother"},"มารดา",-1),e("option",{value:"guardian"},"ผู้ปกครอง",-1),e("option",{value:"other"},"อื่นๆ",-1)])],512),[[T,l(i).relationship]])]),l(C)?(a(),r("div",Fe,u(l(C)),1)):f("",!0),e("div",De,[e("button",{type:"button",onClick:t[17]||(t[17]=s=>g.value=null),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:l(j),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[l(j)?(a(),r("span",Je,"กำลังบันทึก...")):(a(),r("span",Oe,"บันทึก"))],8,Le)])],32)])])):f("",!0)]))}});export{Qe as default};
