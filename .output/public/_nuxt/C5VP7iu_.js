const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BZUAIYhA.js","./LiZfZJ8V.js"])))=>i.map(i=>d[i]);
import{d as k,m as w,p as b,l as C,N as P,r as f,o as R,j as A,O as T,z as B,A as h,c as i,b as o,v as N,e as u,f as O,t as V,w as $,P as E,a as l,g as S}from"./CX4WDIMJ.js";import{_ as j}from"./0JwXLbdW.js";const q={class:"min-h-screen flex items-center justify-center bg-gray-50"},z={class:"text-center"},D={key:0,class:"space-y-4"},I={key:1,class:"space-y-4"},L={class:"text-gray-600"},G=k({__name:"[provider]",async setup(M){let a,d;const r=w();b();const g=A(),{user:y}=C(),{getRedirectPathByRole:v}=([a,d]=P(()=>E(()=>import("./BZUAIYhA.js"),__vite__mapDeps([0,1]),import.meta.url)),a=await a,d(),a),_=r.params.provider,m=f(!0),n=f("");return R(async()=>{try{const t=r.query.code,e=r.query.state;if(!t)throw new Error("Authorization code not found");const s=await $fetch(`${g.public.apiBase}/auth/oauth/${_}/callback`,{method:"POST",body:{code:t,redirect_uri:`${window.location.origin}/auth/callback/${_}`}});if(s.success){y.value=s.data.user;const x=T("access_token",{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:7200});x.value=s.data.accessToken,await B(),await new Promise(c=>setTimeout(c,100));const p=e?decodeURIComponent(e):null;if(p)await h(p);else{const c=v(s.data.user,null);await h(c)}}}catch(t){console.error("OAuth callback error:",t),n.value=t.data?.message||t.message||"เกิดข้อผิดพลาดในการเข้าสู่ระบบ",m.value=!1}}),(t,e)=>{const s=j;return l(),i("div",q,[o("div",z,[u(m)?(l(),i("div",D,[...e[0]||(e[0]=[o("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1),o("p",{class:"text-gray-600"},"กำลังเข้าสู่ระบบ...",-1)])])):u(n)?(l(),i("div",I,[e[2]||(e[2]=o("div",{class:"text-red-600 text-xl"},"เกิดข้อผิดพลาด",-1)),o("p",L,V(u(n)),1),O(s,{to:"/auth/login",class:"text-green-600 hover:text-green-700"},{default:$(()=>[...e[1]||(e[1]=[S(" กลับไปหน้าเข้าสู่ระบบ ",-1)])]),_:1})])):N("",!0)])])}}});export{G as default};
