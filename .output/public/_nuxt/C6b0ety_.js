import{_ as F}from"./PJD1JfRC.js";import{d as q,l as J,p as O,r as x,q as S,o as G,c as i,b as e,k as I,v as C,x as T,y as K,e as a,J as Q,t as l,F as j,i as A,j as W,a as r,n as X,s as f,M as D}from"./CX4WDIMJ.js";import{f as Y}from"./BALXvQ8s.js";import{t as Z}from"./CiM0_A9B.js";const ee={class:"flex items-center justify-between mb-6"},te={class:"bg-white rounded-lg shadow p-4 mb-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"bg-white rounded-lg shadow overflow-hidden"},ae={key:0,class:"p-8 text-center"},ne={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},re={key:2,class:"p-8 text-center text-gray-500"},ie={key:3,class:"min-w-full divide-y divide-gray-200"},le={class:"bg-white divide-y divide-gray-200"},de=["onClick"],ce={class:"text-sm font-medium text-green-600 hover:text-green-700 cursor-pointer"},ue={class:"text-sm text-gray-500"},pe={key:0,class:"text-xs text-gray-400"},ge={class:"px-6 py-4"},me={key:0,class:"space-y-1"},xe={class:"font-medium text-gray-900"},ve={class:"text-gray-500 ml-2"},he={key:1,class:"text-sm text-gray-400"},ye={class:"px-6 py-4 whitespace-nowrap"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ke={class:"flex items-center justify-end space-x-2"},we=["onClick"],_e=["onClick"],Ce=["onClick"],$e=["onClick"],Me={key:4,class:"bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200"},Be={class:"text-sm text-gray-700"},Se={class:"flex space-x-2"},Te=["disabled"],je=["disabled"],ze=q({__name:"index",setup(Ae){const b=W(),{accessToken:k}=J(),E=O(),v=x([]),w=x(!1),h=x(""),g=x(!1),m=x(null),c=S({search:"",status:""}),n=S({page:1,limit:20,total:0,totalPages:0});let _=null;const L=()=>{_&&clearTimeout(_),_=setTimeout(()=>{n.page=1,u()},500)},u=async()=>{w.value=!0,h.value="";try{const o=new URLSearchParams({page:n.page.toString(),limit:n.limit.toString()});c.search&&o.append("search",c.search),c.status&&o.append("status",c.status);const t=await $fetch(`${b.public.apiBase}/admin/students?${o.toString()}`,{headers:{Authorization:`Bearer ${k.value}`}});t.success&&(v.value=t.data,Object.assign(n,t.pagination))}catch(o){console.error("Error loading students:",o),h.value=o.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{w.value=!1}},$=o=>{n.page=o,u()},N=o=>{m.value={...o},g.value=!1},M=()=>{g.value=!1,m.value=null},P=()=>{M(),u()},B=async(o,t,p)=>{const s=v.value.find(y=>y.id===o);if(!s)return;const{confirm:d}=D();if(await d({title:`ยืนยัน${p}`,message:`คุณแน่ใจหรือไม่ว่าต้องการ${p}ผู้เรียน ${s.first_name} ${s.last_name}?`,confirmText:p,cancelText:"ยกเลิก",type:t==="active"?"info":"warning"}))try{await $fetch(`${b.public.apiBase}/admin/users/${o}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${k.value}`},body:{status:t}}),await u()}catch(y){console.error("Error updating status:",y),alert(y.data?.message||"เกิดข้อผิดพลาดในการอัปเดตสถานะ")}},z=async o=>{const{confirm:t}=D();if(await t({title:"ยืนยันการลบ",message:`คุณแน่ใจหรือไม่ว่าต้องการลบผู้เรียน ${o.first_name} ${o.last_name}?
การกระทำนี้ไม่สามารถยกเลิกได้`,confirmText:"ลบ",cancelText:"ยกเลิก",type:"danger"}))try{await $fetch(`${b.public.apiBase}/admin/users/${o.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${k.value}`}}),await u()}catch(s){console.error("Error deleting student:",s),alert(s.data?.message||"เกิดข้อผิดพลาดในการลบผู้เรียน")}},H=o=>({active:"ใช้งาน",inactive:"ปิดใช้งาน",suspended:"ระงับ"})[o]||o,V=o=>({active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",suspended:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800",R=o=>({father:"บิดา",mother:"มารดา",guardian:"ผู้ปกครอง"})[o]||o,U=o=>Y(new Date(o),"dd MMM yyyy",{locale:Z});return G(()=>{u()}),(o,t)=>{const p=F;return r(),i("div",null,[e("div",ee,[t[6]||(t[6]=e("h1",{class:"text-3xl font-bold"},"ผู้เรียน",-1)),e("button",{onClick:t[0]||(t[0]=s=>g.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มผู้เรียน",-1)])])]),e("div",te,[e("div",se,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),T(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a(c).search=s),type:"text",placeholder:"ค้นหาด้วย username, email, ชื่อ",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:L},null,544),[[K,a(c).search]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะ",-1)),T(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a(c).status=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:u},[...t[8]||(t[8]=[e("option",{value:""},"ทั้งหมด",-1),e("option",{value:"active"},"ใช้งาน",-1),e("option",{value:"inactive"},"ปิดใช้งาน",-1),e("option",{value:"suspended"},"ระงับ",-1)])],544),[[Q,a(c).status]])])])]),e("div",oe,[a(w)?(r(),i("div",ae,[...t[10]||(t[10]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):a(h)?(r(),i("div",ne,l(a(h)),1)):a(v).length===0?(r(),i("div",re," ไม่พบผู้เรียน ")):(r(),i("table",ie,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ผู้เรียน"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ผู้ปกครอง"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สถานะ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"วันที่สร้าง"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",le,[(r(!0),i(j,null,A(a(v),s=>(r(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",{class:"px-6 py-4 whitespace-nowrap cursor-pointer",onClick:d=>a(E).push(`/admin/students/${s.id}`)},[e("div",null,[e("div",ce,l(s.first_name)+" "+l(s.last_name),1),e("div",ue,l(s.username),1),s.email?(r(),i("div",pe,l(s.email),1)):C("",!0)])],8,de),e("td",ge,[s.parents&&s.parents.length>0?(r(),i("div",me,[(r(!0),i(j,null,A(s.parents,d=>(r(),i("div",{key:d.id,class:"text-sm"},[e("span",xe,l(d.name),1),e("span",ve,"("+l(R(d.relationship))+")",1)]))),128))])):(r(),i("div",he,"ไม่มีผู้ปกครอง"))]),e("td",ye,[e("span",{class:X(["px-2 py-1 text-xs font-medium rounded",V(s.status)])},l(H(s.status)),3)]),e("td",fe,l(U(s.created_at)),1),e("td",be,[e("div",ke,[e("button",{onClick:f(d=>N(s),["stop"]),class:"text-blue-600 hover:text-blue-900",title:"แก้ไข"},[...t[11]||(t[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,we),s.status==="active"?(r(),i("button",{key:0,onClick:f(d=>B(s.id,"inactive","ปิดใช้งาน"),["stop"]),class:"text-yellow-600 hover:text-yellow-900",title:"ปิดใช้งาน"},[...t[12]||(t[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1)])],8,_e)):(r(),i("button",{key:1,onClick:f(d=>B(s.id,"active","เปิดใช้งาน"),["stop"]),class:"text-green-600 hover:text-green-900",title:"เปิดใช้งาน"},[...t[13]||(t[13]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,Ce)),e("button",{onClick:f(d=>z(s),["stop"]),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...t[14]||(t[14]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,$e)])])]))),128))])])),a(n).totalPages>1?(r(),i("div",Me,[e("div",Be," แสดง "+l((a(n).page-1)*a(n).limit+1)+" ถึง "+l(Math.min(a(n).page*a(n).limit,a(n).total))+" จาก "+l(a(n).total)+" รายการ ",1),e("div",Se,[e("button",{onClick:t[3]||(t[3]=s=>$(a(n).page-1)),disabled:a(n).page===1,class:"px-3 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"}," ก่อนหน้า ",8,Te),e("button",{onClick:t[4]||(t[4]=s=>$(a(n).page+1)),disabled:a(n).page>=a(n).totalPages,class:"px-3 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"}," ถัดไป ",8,je)])])):C("",!0)]),a(g)||a(m)?(r(),I(p,{key:0,show:a(g)||!!a(m),student:a(m),onClose:M,onSaved:P},null,8,["show","student"])):C("",!0)])}}});export{ze as default};
