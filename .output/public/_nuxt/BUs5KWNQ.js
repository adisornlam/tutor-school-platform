import{d as q,l as J,p as P,r as u,q as G,o as I,c as a,b as e,k as K,v as g,x as y,y as O,e as r,J as _,h as Q,F as C,i as $,t as l,j as W,a as n,n as z,s as b,M as A}from"./B_rLn4hw.js";import{E as X}from"./DBy3c5rj.js";import{f as Y}from"./BALXvQ8s.js";import{t as Z}from"./CiM0_A9B.js";import"./DTlFZqZS.js";const ee={class:"flex items-center justify-between mb-6"},te={class:"bg-white rounded-lg shadow p-4 mb-6"},se={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},oe=["value"],re=["value"],ne={class:"bg-white rounded-lg shadow overflow-hidden"},ae={key:0,class:"p-8 text-center"},ie={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},le={key:2,class:"p-8 text-center text-gray-500"},de={key:3,class:"min-w-full divide-y divide-gray-200"},ce={class:"bg-white divide-y divide-gray-200"},ue=["onClick"],pe={class:"text-sm font-medium text-green-600 hover:text-green-700 cursor-pointer"},xe={class:"text-xs text-gray-500"},ge={key:0,class:"text-xs text-gray-400"},me={class:"px-6 py-4"},fe={class:"text-sm font-medium text-gray-900"},ve={key:0,class:"text-xs text-gray-500"},he={class:"px-6 py-4 whitespace-nowrap"},ye={class:"px-6 py-4 whitespace-nowrap"},be={key:0,class:"text-sm text-gray-900"},we={key:0,class:"text-xs text-gray-500"},ke={key:1,class:"text-sm text-gray-500 italic"},_e={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},$e={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Be={class:"flex items-center justify-end space-x-2"},Me=["onClick"],Ee=["onClick"],Te=["onClick"],je=["onClick"],Ue=q({__name:"index",setup(ze){const p=W(),{accessToken:x}=J(),B=P(),m=u([]),M=u([]),E=u([]),w=u(!0),f=u(""),v=u(!1),i=G({search:"",status:"",course_id:"",branch_id:""});let k=null;const S=()=>{k&&clearTimeout(k),k=setTimeout(()=>{d()},500)},V=async()=>{try{const o=await $fetch(`${p.public.apiBase}/admin/courses`,{headers:{Authorization:`Bearer ${x.value}`},params:{status:"published"}});o.success&&(M.value=o.data)}catch(o){console.error("Error loading courses:",o)}},D=async()=>{try{const o=await $fetch(`${p.public.apiBase}/admin/branches`,{headers:{Authorization:`Bearer ${x.value}`}});o.success&&(E.value=o.data)}catch(o){console.error("Error loading branches:",o)}},d=async()=>{w.value=!0,f.value="";try{const o={};i.search&&(o.search=i.search),i.status&&(o.status=i.status),i.course_id&&(o.course_id=i.course_id),i.branch_id&&(o.branch_id=i.branch_id);const t=await $fetch(`${p.public.apiBase}/admin/enrollments`,{headers:{Authorization:`Bearer ${x.value}`},params:o});t.success&&(m.value=t.data)}catch(o){console.error("Error loading enrollments:",o),f.value=o.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{w.value=!1}},T=()=>{v.value=!1},H=async()=>{T(),await d()},j=async(o,t,s)=>{if(!m.value.find(h=>h.id===o))return;const{confirm:R}=A();if(await R({title:`ยืนยัน${s}`,message:`คุณแน่ใจหรือไม่ว่าต้องการ${s}?`,confirmText:s,cancelText:"ยกเลิก",type:t==="active"?"info":"warning"}))try{await $fetch(`${p.public.apiBase}/admin/enrollments/${o}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${x.value}`},body:{status:t}}),await d()}catch(h){console.error("Error updating status:",h),alert(h.data?.message||"เกิดข้อผิดพลาดในการอัปเดตสถานะ")}},L=async o=>{const{confirm:t}=A();if(await t({title:"ยืนยันการลบ",message:`คุณแน่ใจหรือไม่ว่าต้องการลบการลงทะเบียนนี้?
การกระทำนี้ไม่สามารถยกเลิกได้`,confirmText:"ลบ",cancelText:"ยกเลิก",type:"danger"}))try{await $fetch(`${p.public.apiBase}/admin/enrollments/${o.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${x.value}`}}),await d()}catch(c){console.error("Error deleting enrollment:",c),alert(c.data?.message||"เกิดข้อผิดพลาดในการลบการลงทะเบียน")}},U=o=>({pending:"รอการยืนยัน",active:"กำลังเรียน",completed:"เรียนจบ",cancelled:"ยกเลิก"})[o]||o,N=o=>({pending:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800",F=o=>Y(new Date(o),"dd MMM yyyy",{locale:Z});return I(()=>{V(),D(),d()}),(o,t)=>(n(),a("div",null,[e("div",ee,[t[6]||(t[6]=e("h1",{class:"text-3xl font-bold"},"การลงทะเบียน",-1)),e("button",{onClick:t[0]||(t[0]=s=>v.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"ลงทะเบียนใหม่",-1)])])]),e("div",te,[e("div",se,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>r(i).search=s),type:"text",placeholder:"ค้นหาด้วยชื่อนักเรียน, ชื่อคอร์ส",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:S},null,544),[[O,r(i).search]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะ",-1)),y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>r(i).status=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:d},[...t[8]||(t[8]=[Q('<option value="">ทั้งหมด</option><option value="pending">รอการยืนยัน</option><option value="active">กำลังเรียน</option><option value="completed">เรียนจบ</option><option value="cancelled">ยกเลิก</option>',5)])],544),[[_,r(i).status]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"คอร์ส",-1)),y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r(i).course_id=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:d},[t[10]||(t[10]=e("option",{value:""},"ทั้งหมด",-1)),(n(!0),a(C,null,$(r(M),s=>(n(),a("option",{key:s.id,value:s.id},l(s.title),9,oe))),128))],544),[[_,r(i).course_id]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สาขา",-1)),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>r(i).branch_id=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:d},[t[12]||(t[12]=e("option",{value:""},"ทั้งหมด",-1)),(n(!0),a(C,null,$(r(E),s=>(n(),a("option",{key:s.id,value:s.id},l(s.name),9,re))),128))],544),[[_,r(i).branch_id]])])])]),e("div",ne,[r(w)?(n(),a("div",ae,[...t[14]||(t[14]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):r(f)?(n(),a("div",ie,l(r(f)),1)):r(m).length===0?(n(),a("div",le," ไม่พบการลงทะเบียน ")):(n(),a("table",de,[t[19]||(t[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"นักเรียน"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"คอร์ส"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ประเภท"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สาขา/ที่อยู่"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สถานะ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"วันที่ลงทะเบียน"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",ce,[(n(!0),a(C,null,$(r(m),s=>(n(),a("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",{class:"px-6 py-4 cursor-pointer",onClick:c=>r(B).push(`/admin/enrollments/${s.id}`)},[e("div",null,[e("div",pe,l(s.student_first_name)+" "+l(s.student_last_name),1),e("div",xe,"@"+l(s.student_username),1),s.student_email?(n(),a("div",ge,l(s.student_email),1)):g("",!0)])],8,ue),e("td",me,[e("div",null,[e("div",fe,l(s.course_title),1),s.course_code?(n(),a("div",ve,"รหัส: "+l(s.course_code),1)):g("",!0)])]),e("td",he,[e("span",{class:z(["px-2 py-1 text-xs font-medium rounded",s.enrollment_type==="online"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"])},l(s.enrollment_type==="online"?"ออนไลน์":"เรียนสด"),3)]),e("td",ye,[s.enrollment_type==="onsite"?(n(),a("div",be,[e("div",null,l(s.branch_name||"-"),1),s.branch_code?(n(),a("div",we,l(s.branch_code),1)):g("",!0)])):(n(),a("div",ke," เรียนออนไลน์ "))]),e("td",_e,[e("span",{class:z(["px-2 py-1 text-xs font-medium rounded",N(s.status)])},l(U(s.status)),3)]),e("td",Ce,l(F(s.enrollment_date||s.created_at)),1),e("td",$e,[e("div",Be,[e("button",{onClick:b(c=>r(B).push(`/admin/enrollments/${s.id}/edit`),["stop"]),class:"text-green-600 hover:text-green-900",title:"แก้ไข"},[...t[15]||(t[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Me),s.status==="pending"?(n(),a("button",{key:0,onClick:b(c=>j(s.id,"active","ยืนยันการลงทะเบียน"),["stop"]),class:"text-green-600 hover:text-green-900",title:"ยืนยัน"},[...t[16]||(t[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,Ee)):s.status==="active"?(n(),a("button",{key:1,onClick:b(c=>j(s.id,"completed","ปิดการเรียน"),["stop"]),class:"text-blue-600 hover:text-blue-900",title:"ปิดการเรียน"},[...t[17]||(t[17]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,Te)):g("",!0),e("button",{onClick:b(c=>L(s),["stop"]),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,je)])])]))),128))])]))]),r(v)?(n(),K(X,{key:0,show:r(v),enrollment:null,onClose:T,onSaved:H},null,8,["show"])):g("",!0)]))}});export{Ue as default};
