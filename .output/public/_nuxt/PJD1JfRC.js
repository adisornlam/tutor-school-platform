import{d as B,l as V,q as U,r as x,E as _,c as m,v as b,b as t,t as v,s as w,x as d,g as f,y as i,e as n,a as p,j as C}from"./CX4WDIMJ.js";const j={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},q={class:"flex items-center justify-between mb-6"},M={class:"text-2xl font-bold"},S={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},T=["disabled"],E={class:"block text-sm font-medium text-gray-700 mb-2"},z={key:0,class:"text-xs text-gray-500"},A=["required"],N={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},D={class:"flex justify-end space-x-3 pt-4"},O=["disabled"],P={key:0},L={key:1},R=B({__name:"StudentModal",props:{show:{type:Boolean},student:{default:null}},emits:["close","saved"],setup(r,{emit:k}){const g=r,h=k,c=C(),{accessToken:y}=V(),s=U({username:"",email:"",first_name:"",last_name:"",password:"",phone:""}),u=x(!1),a=x("");_(()=>g.student,o=>{o?(s.username=o.username,s.email=o.email||"",s.first_name=o.first_name,s.last_name=o.last_name,s.phone=o.phone||"",s.password=""):(s.username="",s.email="",s.first_name="",s.last_name="",s.password="",s.phone=""),a.value=""},{immediate:!0});const $=async()=>{u.value=!0,a.value="";try{const o={username:s.username,email:s.email||null,first_name:s.first_name,last_name:s.last_name,phone:s.phone||null,roles:["student"]};if(g.student)s.password&&(o.password=s.password),await $fetch(`${c.public.apiBase}/admin/users/${g.student.id}`,{method:"PUT",headers:{Authorization:`Bearer ${y.value}`},body:o});else{if(!s.password){a.value="กรุณากรอกรหัสผ่าน",u.value=!1;return}o.password=s.password,await $fetch(`${c.public.apiBase}/admin/users`,{method:"POST",headers:{Authorization:`Bearer ${y.value}`},body:o})}h("saved")}catch(o){console.error("Error saving student:",o),a.value=o.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{u.value=!1}};return(o,e)=>r.show?(p(),m("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[8]||(e[8]=w(l=>o.$emit("close"),["self"]))},[t("div",j,[t("div",q,[t("h2",M,v(r.student?"แก้ไขผู้เรียน":"เพิ่มผู้เรียน"),1),t("button",{onClick:e[0]||(e[0]=l=>o.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...e[9]||(e[9]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:w($,["prevent"]),class:"space-y-4"},[t("div",S,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Username "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>n(s).username=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",disabled:!!r.student},null,8,T),[[i,n(s).username]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email ",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>n(s).email=l),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[i,n(s).email]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[f(" ชื่อ "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n(s).first_name=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[i,n(s).first_name]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[f(" นามสกุล "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n(s).last_name=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[i,n(s).last_name]])]),t("div",null,[t("label",E,[e[14]||(e[14]=f(" รหัสผ่าน ",-1)),e[15]||(e[15]=t("span",{class:"text-red-500"},"*",-1)),r.student?(p(),m("span",z,"(เว้นว่างไว้ถ้าไม่ต้องการเปลี่ยน)")):b("",!0)]),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n(s).password=l),type:"password",required:!r.student,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,8,A),[[i,n(s).password]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," เบอร์โทรศัพท์ ",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n(s).phone=l),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[i,n(s).phone]])])]),n(a)?(p(),m("div",N,v(n(a)),1)):b("",!0),t("div",D,[t("button",{type:"button",onClick:e[7]||(e[7]=l=>o.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),t("button",{type:"submit",disabled:n(u),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[n(u)?(p(),m("span",P,"กำลังบันทึก...")):(p(),m("span",L,"บันทึก"))],8,O)])],32)])])):b("",!0)}}),G=Object.assign(R,{__name:"StudentModal"});export{G as _};
