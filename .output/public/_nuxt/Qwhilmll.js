import{d as A,l as E,q as z,r as y,E as O,c as u,v as _,b as e,t as m,s as k,x as g,g as V,y as w,e as n,J as L,a as d,j as D,o as R,k as J,F as G,i as I,n as K,M as U}from"./CX4WDIMJ.js";import{f as Q}from"./BALXvQ8s.js";import{t as W}from"./CiM0_A9B.js";const X={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Y={class:"flex items-center justify-between mb-6"},Z={class:"text-2xl font-bold"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"md:col-span-2"},se={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},oe={class:"flex justify-end space-x-3 pt-4"},ne=["disabled"],ae={key:0},re={key:1},le=A({__name:"BranchModal",props:{show:{type:Boolean},branch:{default:null}},emits:["close","saved"],setup(M,{emit:$}){const x=M,f=$,b=D(),{accessToken:v}=E(),o=z({name:"",code:"",address:"",phone:"",email:"",status:"active"}),p=y(!1),c=y("");O(()=>x.branch,l=>{l?(o.name=l.name,o.code=l.code,o.address=l.address||"",o.phone=l.phone||"",o.email=l.email||"",o.status=l.status):(o.name="",o.code="",o.address="",o.phone="",o.email="",o.status="active"),c.value=""},{immediate:!0});const B=async()=>{p.value=!0,c.value="";try{const l={name:o.name,code:o.code,address:o.address||null,phone:o.phone||null,email:o.email||null,status:o.status};x.branch?await $fetch(`${b.public.apiBase}/admin/settings/branches/${x.branch.id}`,{method:"PUT",headers:{Authorization:`Bearer ${v.value}`},body:l}):await $fetch(`${b.public.apiBase}/admin/settings/branches`,{method:"POST",headers:{Authorization:`Bearer ${v.value}`},body:l}),f("saved"),f("close")}catch(l){console.error("Error saving branch:",l),c.value=l.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{p.value=!1}};return(l,t)=>M.show?(d(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[8]||(t[8]=k(i=>l.$emit("close"),["self"]))},[e("div",X,[e("div",Y,[e("h2",Z,m(M.branch?"แก้ไขสาขา":"เพิ่มสาขา"),1),e("button",{onClick:t[0]||(t[0]=i=>l.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...t[9]||(t[9]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:k(B,["prevent"]),class:"space-y-4"},[e("div",ee,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" ชื่อสาขา "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>n(o).name=i),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,n(o).name]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" รหัสสาขา "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>n(o).code=i),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,n(o).code]])]),e("div",te,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ที่อยู่ ",-1)),g(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=i=>n(o).address=i),rows:"3",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,n(o).address]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," เบอร์โทรศัพท์ ",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>n(o).phone=i),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,n(o).phone]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," อีเมล ",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>n(o).email=i),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[w,n(o).email]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," สถานะ ",-1)),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>n(o).status=i),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...t[15]||(t[15]=[e("option",{value:"active"},"ใช้งาน",-1),e("option",{value:"inactive"},"ปิดใช้งาน",-1)])],512),[[L,n(o).status]])])]),n(c)?(d(),u("div",se,m(n(c)),1)):_("",!0),e("div",oe,[e("button",{type:"button",onClick:t[7]||(t[7]=i=>l.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:n(p),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[n(p)?(d(),u("span",ae,"กำลังบันทึก...")):(d(),u("span",re,"บันทึก"))],8,ne)])],32)])])):_("",!0)}}),ie=Object.assign(le,{__name:"BranchModal"}),de={class:"flex items-center justify-between mb-6"},ue={class:"bg-white rounded-lg shadow p-4 mb-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe={class:"bg-white rounded-lg shadow overflow-hidden"},me={key:0,class:"p-8 text-center"},ge={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},xe={key:2,class:"p-8 text-center text-gray-500"},fe={key:3,class:"min-w-full divide-y divide-gray-200"},ve={class:"bg-white divide-y divide-gray-200"},ye={class:"px-6 py-4 whitespace-nowrap"},be={class:"text-sm font-medium text-gray-900"},he={class:"text-sm text-gray-500"},we={class:"px-6 py-4"},ke={class:"text-sm text-gray-900"},$e={class:"px-6 py-4 whitespace-nowrap"},Be={class:"text-sm text-gray-900"},Ce={key:0},_e={key:1,class:"text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},je={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Se={class:"flex items-center justify-end space-x-2"},Ve=["onClick"],Ue=["onClick"],Ae=["onClick"],Ee=["onClick"],Ne=A({__name:"index",setup(M){const $=D(),{accessToken:x}=E(),f=y([]),b=y(!1),v=y(""),o=y(!1),p=y(null),c=z({search:"",status:""});let B=null;const l=()=>{B&&clearTimeout(B),B=setTimeout(()=>{t()},500)},t=async()=>{b.value=!0,v.value="";try{const r=new URLSearchParams;c.search&&r.append("search",c.search),c.status&&r.append("status",c.status);const s=await $fetch(`${$.public.apiBase}/admin/settings/branches?${r.toString()}`,{headers:{Authorization:`Bearer ${x.value}`}});s.success&&(f.value=s.data)}catch(r){console.error("Error loading branches:",r),v.value=r.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{b.value=!1}},i=r=>{p.value={...r},o.value=!1},j=()=>{o.value=!1,p.value=null},H=()=>{j(),t()},S=async(r,s,h)=>{const a=f.value.find(T=>T.id===r);if(!a)return;const{confirm:C}=U();if(await C({title:`ยืนยัน${h}`,message:`คุณแน่ใจหรือไม่ว่าต้องการ${h}สาขา ${a.name}?`,confirmText:h,cancelText:"ยกเลิก",type:s==="active"?"info":"warning"}))try{await $fetch(`${$.public.apiBase}/admin/settings/branches/${r}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${x.value}`},body:{status:s}}),await t()}catch(T){console.error("Error updating status:",T),alert(T.data?.message||"เกิดข้อผิดพลาดในการอัปเดตสถานะ")}},N=async r=>{const{confirm:s}=U();if(await s({title:"ยืนยันการลบ",message:`คุณแน่ใจหรือไม่ว่าต้องการลบสาขา ${r.name}?
การกระทำนี้ไม่สามารถยกเลิกได้`,confirmText:"ลบ",cancelText:"ยกเลิก",type:"danger"}))try{await $fetch(`${$.public.apiBase}/admin/settings/branches/${r.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${x.value}`}}),await t()}catch(a){console.error("Error deleting branch:",a),alert(a.data?.message||"เกิดข้อผิดพลาดในการลบสาขา")}},P=r=>({active:"ใช้งาน",inactive:"ปิดใช้งาน"})[r]||r,q=r=>({active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800"})[r]||"bg-gray-100 text-gray-800",F=r=>Q(new Date(r),"dd MMM yyyy",{locale:W});return R(()=>{t()}),(r,s)=>{const h=ie;return d(),u("div",null,[e("div",de,[s[4]||(s[4]=e("h1",{class:"text-3xl font-bold"},"จัดการสาขา",-1)),e("button",{onClick:s[0]||(s[0]=a=>o.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...s[3]||(s[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มสาขา",-1)])])]),e("div",ue,[e("div",ce,[e("div",null,[s[5]||(s[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),g(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>n(c).search=a),type:"text",placeholder:"ค้นหาด้วยชื่อสาขา, รหัสสาขา, ที่อยู่",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:l},null,544),[[w,n(c).search]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะ",-1)),g(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>n(c).status=a),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:t},[...s[6]||(s[6]=[e("option",{value:""},"ทั้งหมด",-1),e("option",{value:"active"},"ใช้งาน",-1),e("option",{value:"inactive"},"ปิดใช้งาน",-1)])],544),[[L,n(c).status]])])])]),e("div",pe,[n(b)?(d(),u("div",me,[...s[8]||(s[8]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):n(v)?(d(),u("div",ge,m(n(v)),1)):n(f).length===0?(d(),u("div",xe," ไม่พบสาขา ")):(d(),u("table",fe,[s[13]||(s[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สาขา"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ที่อยู่"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ติดต่อ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สถานะ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"วันที่สร้าง"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",ve,[(d(!0),u(G,null,I(n(f),a=>(d(),u("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",ye,[e("div",null,[e("div",be,m(a.name),1),e("div",he,"รหัส: "+m(a.code),1)])]),e("td",we,[e("div",ke,m(a.address||"-"),1)]),e("td",$e,[e("div",Be,[a.phone?(d(),u("div",Ce,m(a.phone),1)):_("",!0),a.email?(d(),u("div",_e,m(a.email),1)):_("",!0)])]),e("td",Me,[e("span",{class:K(["px-2 py-1 text-xs font-medium rounded",q(a.status)])},m(P(a.status)),3)]),e("td",Te,m(F(a.created_at)),1),e("td",je,[e("div",Se,[e("button",{onClick:k(C=>i(a),["stop"]),class:"text-blue-600 hover:text-blue-900",title:"แก้ไข"},[...s[9]||(s[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Ve),a.status==="active"?(d(),u("button",{key:0,onClick:k(C=>S(a.id,"inactive","ปิดใช้งาน"),["stop"]),class:"text-yellow-600 hover:text-yellow-900",title:"ปิดใช้งาน"},[...s[10]||(s[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1)])],8,Ue)):(d(),u("button",{key:1,onClick:k(C=>S(a.id,"active","เปิดใช้งาน"),["stop"]),class:"text-green-600 hover:text-green-900",title:"เปิดใช้งาน"},[...s[11]||(s[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,Ae)),e("button",{onClick:k(C=>N(a),["stop"]),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...s[12]||(s[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ee)])])]))),128))])]))]),n(o)||n(p)?(d(),J(h,{key:0,show:n(o)||!!n(p),branch:n(p),onClose:j,onSaved:H},null,8,["show","branch"])):_("",!0)])}}});export{Ne as default};
