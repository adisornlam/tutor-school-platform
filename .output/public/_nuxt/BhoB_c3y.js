import{_ as L}from"./BlVozWiI.js";import{d as R,l as q,m as V,p as N,q as T,r as m,c as d,b as s,s as B,v as E,x as p,y as f,e as o,f as x,w as b,t as A,g,a as u,z as C,A as y}from"./B_rLn4hw.js";import{getRedirectPathByRole as M}from"./BZUAIYhA.js";import"./LiZfZJ8V.js";const P={class:"min-h-[calc(100vh-200px)] flex items-center justify-center py-12"},U={class:"max-w-md w-full mx-4"},j={class:"bg-white rounded-lg shadow-lg p-8"},D={class:"flex items-center justify-between"},S={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},z=["disabled"],F={key:0},I={key:1},G={class:"mt-6 text-center"},H={class:"text-gray-600"},X=R({__name:"login",setup(J){const{login:w,user:h}=q(),v=V();N();const r=T({username:"",password:""}),n=m(!1),l=m(""),_=async()=>{n.value=!0,l.value="";try{console.log("[Login] Attempting login with username:",r.username);const t=await w(r.username,r.password);if(console.log("[Login] Login response:",t),t.success){await C(),await new Promise(k=>setTimeout(k,100));const e=v.query.redirect;if(console.log("[Login] Redirect query param:",e),e){console.log("[Login] Redirecting to requested path:",e),await y(e);return}const i=t.data.user,a=h.value||i,c=M(a,e);console.log("[Login] Redirecting to role-based path:",c),await y(c)}}catch(t){console.error("[Login] Error:",t),console.error("[Login] Error data:",t.data),console.error("[Login] Error message:",t.message);let e="เกิดข้อผิดพลาดในการเข้าสู่ระบบ";t.data?.message?e=t.data.message:t.data?.error?.message?e=t.data.error.message:t.message?e=t.message:typeof t.data=="string"&&(e=t.data),l.value=e}finally{n.value=!1}};return(t,e)=>{const i=L;return u(),d("div",P,[s("div",U,[s("div",j,[e[8]||(e[8]=s("h1",{class:"text-3xl font-bold text-center mb-8"},"เข้าสู่ระบบ",-1)),s("form",{onSubmit:B(_,["prevent"]),class:"space-y-6"},[s("div",null,[e[2]||(e[2]=s("label",{for:"username",class:"block text-sm font-medium text-gray-700 mb-2"}," ชื่อผู้ใช้งาน ",-1)),p(s("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=a=>o(r).username=a),type:"text",required:"",class:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-gray-900 placeholder-gray-400",placeholder:"username หรือ email"},null,512),[[f,o(r).username]])]),s("div",null,[e[3]||(e[3]=s("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-2"}," รหัสผ่าน ",-1)),p(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>o(r).password=a),type:"password",required:"",class:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-gray-900 placeholder-gray-400",placeholder:"••••••••"},null,512),[[f,o(r).password]])]),s("div",D,[e[5]||(e[5]=s("label",{class:"flex items-center cursor-pointer"},[s("input",{type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-green-600 focus:ring-green-500 bg-white checked:bg-green-600 checked:border-green-600"}),s("span",{class:"ml-2 text-sm text-gray-600"},"จดจำฉัน")],-1)),x(i,{to:"/auth/forgot-password",class:"text-sm text-green-600 hover:text-green-700"},{default:b(()=>[...e[4]||(e[4]=[g(" ลืมรหัสผ่าน? ",-1)])]),_:1})]),o(l)?(u(),d("div",S,A(o(l)),1)):E("",!0),s("button",{type:"submit",disabled:o(n),class:"w-full py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[o(n)?(u(),d("span",F,"กำลังเข้าสู่ระบบ...")):(u(),d("span",I,"เข้าสู่ระบบ"))],8,z)],32),s("div",G,[s("p",H,[e[7]||(e[7]=g(" ยังไม่มีบัญชี? ",-1)),x(i,{to:"/auth/register",class:"text-green-600 hover:text-green-700 font-semibold"},{default:b(()=>[...e[6]||(e[6]=[g(" สมัครสมาชิก ",-1)])]),_:1})])])])])])}}});export{X as default};
