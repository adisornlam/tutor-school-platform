import{d as A,l as B,q as C,r as h,E as V,c as n,v as c,b as t,t as x,s as _,x as a,g as p,y as m,e as o,F as T,i as N,a as d,n as S,L as j,j as q}from"./CX4WDIMJ.js";import{UserRole as g}from"./LiZfZJ8V.js";const E={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},R={class:"flex items-center justify-between mb-6"},D={class:"text-2xl font-bold"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},z=["disabled"],I={class:"block text-sm font-medium text-gray-700 mb-2"},L={key:0,class:"text-xs text-gray-500"},F=["required"],P={class:"md:col-span-2"},H={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},W=["value"],Y={class:"text-sm font-medium"},G={key:0,class:"mt-2 text-sm text-red-600"},J={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},K={class:"flex justify-end space-x-3 pt-4"},Q=["disabled"],X={key:0},Z={key:1},ee=A({__name:"UserModal",props:{show:{type:Boolean},user:{default:null}},emits:["close","saved"],setup(i,{emit:U}){const b=i,y=U,v=q(),{accessToken:w}=B(),k=[{value:g.SYSTEM_ADMIN,label:"System Admin"},{value:g.OWNER,label:"Owner"},{value:g.ADMIN,label:"Admin กลาง"},{value:g.BRANCH_ADMIN,label:"Admin สาขา"},{value:g.TUTOR,label:"Tutor"}],e=C({username:"",email:"",first_name:"",last_name:"",password:"",phone:"",roles:[]}),f=h(!1),u=h("");V(()=>b.user,r=>{r?(e.username=r.username,e.email=r.email||"",e.first_name=r.first_name,e.last_name=r.last_name,e.phone=r.phone||"",e.password="",e.roles=r.roles.filter(s=>k.some(l=>l.value===s))):(e.username="",e.email="",e.first_name="",e.last_name="",e.password="",e.phone="",e.roles=[]),u.value=""},{immediate:!0});const $=async()=>{if(e.roles.length===0){u.value="กรุณาเลือกอย่างน้อย 1 บทบาท";return}f.value=!0,u.value="";try{const r={username:e.username,email:e.email||null,first_name:e.first_name,last_name:e.last_name,phone:e.phone||null,roles:e.roles};(!b.user||e.password)&&e.password&&(r.password=e.password),b.user?await $fetch(`${v.public.apiBase}/admin/users/${b.user.id}`,{method:"PUT",headers:{Authorization:`Bearer ${w.value}`},body:r}):await $fetch(`${v.public.apiBase}/admin/users`,{method:"POST",headers:{Authorization:`Bearer ${w.value}`},body:r}),y("saved"),y("close")}catch(r){console.error("Error saving user:",r),u.value=r.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{f.value=!1}};return(r,s)=>i.show?(d(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:s[9]||(s[9]=_(l=>r.$emit("close"),["self"]))},[t("div",E,[t("div",R,[t("h2",D,x(i.user?"แก้ไขผู้ใช้งาน":"เพิ่มผู้ใช้งาน"),1),t("button",{onClick:s[0]||(s[0]=l=>r.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...s[10]||(s[10]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:_($,["prevent"]),class:"space-y-4"},[t("div",O,[t("div",null,[s[11]||(s[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Username "),t("span",{class:"text-red-500"},"*")],-1)),a(t("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>o(e).username=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",disabled:!!i.user},null,8,z),[[m,o(e).username]])]),t("div",null,[s[12]||(s[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email ",-1)),a(t("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>o(e).email=l),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[m,o(e).email]])]),t("div",null,[s[13]||(s[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" ชื่อ "),t("span",{class:"text-red-500"},"*")],-1)),a(t("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>o(e).first_name=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[m,o(e).first_name]])]),t("div",null,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" นามสกุล "),t("span",{class:"text-red-500"},"*")],-1)),a(t("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>o(e).last_name=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[m,o(e).last_name]])]),t("div",null,[t("label",I,[s[15]||(s[15]=p(" รหัสผ่าน ",-1)),s[16]||(s[16]=t("span",{class:"text-red-500"},"*",-1)),i.user?(d(),n("span",L,"(เว้นว่างไว้ถ้าไม่ต้องการเปลี่ยน)")):c("",!0)]),a(t("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>o(e).password=l),type:"password",required:!i.user,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,8,F),[[m,o(e).password]])]),t("div",null,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," เบอร์โทรศัพท์ ",-1)),a(t("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>o(e).phone=l),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[m,o(e).phone]])]),t("div",P,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" บทบาท "),t("span",{class:"text-red-500"},"*")],-1)),t("div",H,[(d(),n(T,null,N(k,l=>t("label",{key:l.value,class:S(["flex items-center space-x-2 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50",{"bg-green-50 border-green-500":o(e).roles.includes(l.value)}])},[a(t("input",{type:"checkbox",value:l.value,"onUpdate:modelValue":s[7]||(s[7]=M=>o(e).roles=M),class:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"},null,8,W),[[j,o(e).roles]]),t("span",Y,x(l.label),1)],2)),64))]),o(e).roles.length===0?(d(),n("p",G," กรุณาเลือกอย่างน้อย 1 บทบาท ")):c("",!0)])]),o(u)?(d(),n("div",J,x(o(u)),1)):c("",!0),t("div",K,[t("button",{type:"button",onClick:s[8]||(s[8]=l=>r.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),t("button",{type:"submit",disabled:o(f)||o(e).roles.length===0,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[o(f)?(d(),n("span",X,"กำลังบันทึก...")):(d(),n("span",Z,"บันทึก"))],8,Q)])],32)])])):c("",!0)}}),le=Object.assign(ee,{__name:"UserModal"});export{le as _};
