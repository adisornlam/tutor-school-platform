import{_ as P}from"./BlVozWiI.js";import{d as R,l as S,r as p,q as C,o as T,c as i,b as t,x as y,J as $,e as o,y as j,H as U,F as N,i as B,t as n,v as q,j as z,a as l,n as E,f as F,w as H,g as J}from"./B_rLn4hw.js";import{f as O}from"./cL3ZD5Hb.js";import{t as Q}from"./CiM0_A9B.js";import"./DDxt_u6O.js";const G={class:"bg-white rounded-lg shadow p-4 mb-6"},K={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},W=["value"],X={class:"bg-white rounded-lg shadow overflow-hidden"},Y={key:0,class:"p-8 text-center text-gray-500"},Z={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},tt={key:2},et={class:"min-w-full divide-y divide-gray-200"},st={class:"bg-white divide-y divide-gray-200"},at={class:"px-6 py-4 whitespace-nowrap"},ot={class:"text-sm font-medium text-gray-900"},rt={class:"px-6 py-4 whitespace-nowrap"},nt={class:"text-sm text-gray-900"},it={class:"px-6 py-4 whitespace-nowrap"},lt={class:"text-sm text-gray-900"},dt={class:"px-6 py-4"},ut={class:"text-sm text-gray-900"},ct={class:"text-xs text-gray-500"},pt={class:"px-6 py-4 whitespace-nowrap"},gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ft={key:0,class:"px-6 py-4 border-t flex items-center justify-between"},mt={class:"text-sm text-gray-700"},yt={class:"flex space-x-2"},bt=["disabled"],vt=["disabled"],Nt=R({__name:"index",setup(ht){const b=z(),{accessToken:v}=S(),h=p([]),w=p([]),f=p(!1),g=p(""),c=p(""),d=C({status:"",courseId:null}),r=C({page:1,limit:50,total:0,totalPages:0,offset:0}),m=async()=>{f.value=!0,g.value="";try{const a={limit:r.limit,offset:r.offset};d.status&&(a.status=d.status),d.courseId&&(a.courseId=d.courseId);const e=new URLSearchParams(a).toString(),u=await $fetch(`${b.public.apiBase}/admin/chat/rooms?${e}`,{headers:{Authorization:`Bearer ${v.value}`}});if(u.success){let s=u.data;if(c.value.trim()){const k=c.value.toLowerCase();s=u.data.filter(x=>{const A=`${x.student?.first_name} ${x.student?.last_name}`.toLowerCase(),D=`${x.tutor?.first_name} ${x.tutor?.last_name}`.toLowerCase();return A.includes(k)||D.includes(k)})}h.value=s,Object.assign(r,u.pagination)}}catch(a){g.value=a.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล",console.error("[Admin Chat] Error loading rooms:",a)}finally{f.value=!1}},V=async()=>{try{const a=await $fetch(`${b.public.apiBase}/admin/courses`,{headers:{Authorization:`Bearer ${v.value}`}});a.success&&(w.value=a.data)}catch(a){console.error("[Admin Chat] Error loading courses:",a)}},I=()=>{r.page=1,r.offset=0,m()},_=a=>{r.page=a,r.offset=(a-1)*r.limit,m()},L=a=>({active:"เปิดใช้งาน",archived:"เก็บถาวร",closed:"ปิด"})[a]||a,M=a=>{if(!a)return"-";try{return O(new Date(a),{addSuffix:!0,locale:Q})}catch{return a}};return T(async()=>{await V(),await m()}),(a,e)=>{const u=P;return l(),i("div",null,[e[13]||(e[13]=t("div",{class:"flex items-center justify-between mb-6"},[t("h1",{class:"text-3xl font-bold"},"จัดการแชท")],-1)),t("div",G,[t("div",K,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะ",-1)),y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o(d).status=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...e[5]||(e[5]=[t("option",{value:""},"ทั้งหมด",-1),t("option",{value:"active"},"เปิดใช้งาน",-1),t("option",{value:"archived"},"เก็บถาวร",-1),t("option",{value:"closed"},"ปิด",-1)])],512),[[$,o(d).status]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา (ชื่อผู้เรียน/อาจารย์)",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>U(c)?c.value=s:null),type:"text",placeholder:"ค้นหา...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[j,o(c)]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"คอร์ส",-1)),y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(d).courseId=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[e[8]||(e[8]=t("option",{value:null},"ทั้งหมด",-1)),(l(!0),i(N,null,B(o(w),s=>(l(),i("option",{key:s.id,value:s.id},n(s.title),9,W))),128))],512),[[$,o(d).courseId,void 0,{number:!0}]])]),t("div",{class:"flex items-end"},[t("button",{onClick:I,class:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"}," ค้นหา ")])])]),t("div",X,[o(f)?(l(),i("div",Y,[...e[10]||(e[10]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),t("p",{class:"mt-2"},"กำลังโหลด...",-1)])])):o(g)?(l(),i("div",Z,n(o(g)),1)):(l(),i("div",tt,[t("table",et,[e[12]||(e[12]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ห้องแชท "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ผู้เรียน "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," อาจารย์ "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," คอร์ส "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," สถานะ "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," อัพเดตล่าสุด "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," การจัดการ ")])],-1)),t("tbody",st,[(l(!0),i(N,null,B(o(h),s=>(l(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",at,[t("div",ot," #"+n(s.id),1)]),t("td",rt,[t("div",nt,n(s.student?.first_name)+" "+n(s.student?.last_name),1)]),t("td",it,[t("div",lt,n(s.tutor?.first_name)+" "+n(s.tutor?.last_name),1)]),t("td",dt,[t("div",ut,n(s.course?.title),1),t("div",ct,n(s.course?.code),1)]),t("td",pt,[t("span",{class:E(["px-2 py-1 text-xs font-semibold rounded-full",s.status==="active"?"bg-green-100 text-green-800":s.status==="archived"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},n(L(s.status)),3)]),t("td",gt,n(M(s.last_message_at||s.updated_at)),1),t("td",xt,[F(u,{to:`/admin/chat/${s.id}`,class:"text-green-600 hover:text-green-900"},{default:H(()=>[...e[11]||(e[11]=[J(" ดูแชท ",-1)])]),_:1},8,["to"])])]))),128))])]),o(r).totalPages>1?(l(),i("div",ft,[t("div",mt," แสดง "+n((o(r).offset||0)+1)+" - "+n(Math.min((o(r).offset||0)+(o(r).limit||50),o(r).total))+" จาก "+n(o(r).total),1),t("div",yt,[t("button",{onClick:e[3]||(e[3]=s=>_(o(r).page-1)),disabled:o(r).page<=1,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ก่อนหน้า ",8,bt),t("button",{onClick:e[4]||(e[4]=s=>_(o(r).page+1)),disabled:o(r).page>=o(r).totalPages,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ถัดไป ",8,vt)])])):q("",!0)]))])])}}});export{Nt as default};
