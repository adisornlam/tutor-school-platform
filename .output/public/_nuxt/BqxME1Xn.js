import{_ as z}from"./BlVozWiI.js";import{d as A,l as F,r as c,B as _,o as L,c as l,b as t,e as a,t as n,F as b,i as w,g as m,x as k,J as C,H as D,v as d,f as T,w as y,j as R,a as r,n as B,k as U}from"./B_rLn4hw.js";import{f as H}from"./BALXvQ8s.js";import{t as J}from"./CiM0_A9B.js";const P={key:0,class:"text-center py-12"},q={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6"},G={class:"flex items-center gap-4 mb-6 border-b border-gray-200"},I=["onClick"],K={class:"flex items-center justify-between mb-6"},O={class:"text-gray-600"},Q={class:"font-semibold"},W={class:"flex items-center gap-4"},X={class:"space-y-4"},Y={class:"w-48 h-32 bg-gray-200 rounded-lg flex-shrink-0 overflow-hidden"},Z=["src","alt"],ee={key:1,class:"w-full h-full flex items-center justify-center text-gray-400"},te={class:"flex-1"},se={class:"flex items-start justify-between mb-2"},oe={class:"flex-1"},re={class:"flex items-center gap-2 mb-1"},le={key:0,class:"text-sm text-gray-500"},ne={key:1,class:"text-xs text-gray-400"},ae={class:"text-xl font-semibold mb-2"},ie={key:0,class:"text-gray-600 text-sm mb-4 line-clamp-2"},de={class:"flex items-center justify-between"},ue={class:"text-sm text-gray-500"},ce={key:0,class:"ml-2"},me={class:"flex items-center gap-2"},pe={key:0,class:"text-center py-12 bg-white rounded-lg shadow"},ge={class:"mt-6"},_e=A({__name:"my-courses",setup(fe){const M=R(),{accessToken:j,user:N}=F(),f=c("all"),p=c("all"),u=c("newest"),h=c([]),v=c(!0),g=c(""),V=_(()=>N.value?.roles?.includes("parent")),$=[{id:"all",label:"การเรียนทั้งหมด"},{id:"active",label:"กำลังเรียน"},{id:"completed",label:"เรียนจบแล้ว"}],x=_(()=>{let o=[...h.value];return f.value==="active"?o=o.filter(e=>e.status==="active"):f.value==="completed"&&(o=o.filter(e=>e.status==="completed")),p.value!=="all"&&(o=o.filter(e=>e.enrollmentType===p.value)),u.value==="newest"?o.sort((e,i)=>new Date(i.enrollmentDate).getTime()-new Date(e.enrollmentDate).getTime()):u.value==="oldest"?o.sort((e,i)=>new Date(e.enrollmentDate).getTime()-new Date(i.enrollmentDate).getTime()):u.value==="title"&&o.sort((e,i)=>e.course.title.localeCompare(i.course.title,"th")),o}),E=o=>{try{return H(new Date(o),"d MMMM yyyy",{locale:J})}catch{return o}},S=async()=>{v.value=!0,g.value="";try{const o=await $fetch(`${M.public.apiBase}/learning/my-courses`,{headers:{Authorization:`Bearer ${j.value}`}});o.success?h.value=o.data:g.value="ไม่สามารถโหลดข้อมูลได้"}catch(o){console.error("[My Courses] Error loading enrollments:",o),g.value=o.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{v.value=!1}};return L(()=>{S()}),(o,e)=>{const i=z;return r(),l("div",null,[e[15]||(e[15]=t("h1",{class:"text-3xl font-bold mb-6"},"คอร์สเรียนของฉัน",-1)),a(v)?(r(),l("div",P,[...e[2]||(e[2]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1),t("p",{class:"mt-4 text-gray-600"},"กำลังโหลดข้อมูล...",-1)])])):a(g)?(r(),l("div",q,n(a(g)),1)):(r(),l(b,{key:2},[t("div",G,[(r(),l(b,null,w($,s=>t("button",{key:s.id,onClick:ve=>f.value=s.id,class:B(["px-4 py-2 font-semibold transition-colors relative",a(f)===s.id?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-green-600"])},n(s.label),11,I)),64))]),t("div",K,[t("div",O,[e[3]||(e[3]=m(" จำนวน: ",-1)),t("span",Q,n(a(x).length),1),e[4]||(e[4]=m(" คอร์ส ",-1))]),t("div",W,[k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>D(p)?p.value=s:null),class:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...e[5]||(e[5]=[t("option",{value:"all"},"ทุกประเภทการเรียน",-1),t("option",{value:"onsite"},"เรียนที่สาขา",-1),t("option",{value:"online"},"เรียนออนไลน์",-1)])],512),[[C,a(p)]]),k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>D(u)?u.value=s:null),class:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},[...e[6]||(e[6]=[t("option",{value:"newest"},"วันที่ลงเรียนใหม่-เก่า",-1),t("option",{value:"oldest"},"วันที่ลงเรียนเก่า-ใหม่",-1),t("option",{value:"title"},"ชื่อคอร์ส (ก-ฮ)",-1)])],512),[[C,a(u)]])])]),t("div",X,[(r(!0),l(b,null,w(a(x),s=>(r(),l("div",{key:s.id,class:"bg-white rounded-lg shadow p-6 flex gap-6 hover:shadow-md transition-shadow"},[t("div",Y,[s.course.thumbnail_url?(r(),l("img",{key:0,src:s.course.thumbnail_url,alt:s.course.title,class:"w-full h-full object-cover"},null,8,Z)):(r(),l("div",ee,[...e[7]||(e[7]=[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1)])]))]),t("div",te,[t("div",se,[t("div",oe,[t("div",re,[t("span",{class:B(["px-2 py-1 text-xs font-semibold rounded",s.enrollmentType==="online"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"])},n(s.enrollmentType==="online"?"เรียนออนไลน์":"เรียนที่สาขา"),3),s.branch?(r(),l("span",le,n(s.branch.name),1)):d("",!0),s.course.code?(r(),l("span",ne,n(s.course.code),1)):d("",!0)]),t("h3",ae,n(s.course.title),1),s.course.description?(r(),l("p",ie,n(s.course.description),1)):d("",!0)])]),d("",!0),t("div",de,[t("div",ue,[m(" ลงทะเบียนเมื่อ: "+n(E(s.enrollmentDate))+" ",1),s.student&&a(V)?(r(),l("span",ce," ("+n(s.student.firstName)+" "+n(s.student.lastName)+") ",1)):d("",!0)]),t("div",me,[T(i,{to:`/courses/${s.course.id}`,class:"px-4 py-2 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition-colors"},{default:y(()=>[...e[9]||(e[9]=[m(" ดูรายละเอียด ",-1)])]),_:1},8,["to"]),s.enrollmentType==="online"?(r(),U(i,{key:0,to:`/learning/courses/${s.course.id}`,class:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold"},{default:y(()=>[...e[10]||(e[10]=[m(" เริ่มเรียน ",-1)])]),_:1},8,["to"])):d("",!0)])])])]))),128)),a(x).length===0?(r(),l("div",pe,[e[12]||(e[12]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1)),e[13]||(e[13]=t("h3",{class:"mt-2 text-sm font-semibold text-gray-900"},"ยังไม่มีคอร์สเรียน",-1)),e[14]||(e[14]=t("p",{class:"mt-1 text-sm text-gray-500"},"เริ่มต้นเรียนกับเราได้เลย",-1)),t("div",ge,[T(i,{to:"/courses",class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700"},{default:y(()=>[...e[11]||(e[11]=[m(" ดูคอร์สเรียนทั้งหมด ",-1)])]),_:1})])])):d("",!0)])],64))])}}});export{_e as default};
