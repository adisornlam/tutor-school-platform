import{_ as I}from"./C2YKbQDp.js";import{d as q,l as J,r as g,q as S,o as G,c as l,b as e,k as K,v as b,x as C,y as Q,e as o,J as A,h as W,t as i,F as j,i as N,s as X,g as T,j as Y,a as r,n as U}from"./CX4WDIMJ.js";import{f as Z}from"./BALXvQ8s.js";import{t as ee}from"./CiM0_A9B.js";import"./LiZfZJ8V.js";const te={class:"flex items-center justify-between mb-6"},se={class:"bg-white rounded-lg shadow p-4 mb-6"},oe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ne={class:"bg-white rounded-lg shadow overflow-hidden"},ae={key:0,class:"p-8 text-center"},re={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},le={key:2,class:"p-8 text-center text-gray-500"},ie={key:3,class:"min-w-full divide-y divide-gray-200"},de={class:"bg-white divide-y divide-gray-200"},ue={class:"px-6 py-4 whitespace-nowrap"},pe={class:"text-sm font-medium text-gray-900"},ce={class:"text-sm text-gray-500"},ge={key:0,class:"text-xs text-gray-400"},me={class:"px-6 py-4 whitespace-nowrap"},xe={class:"flex flex-wrap gap-1"},ve={class:"px-6 py-4 whitespace-nowrap"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},fe={class:"flex items-center justify-end space-x-2"},he=["onClick"],we=["onClick"],ke=["onClick"],_e=["onClick"],Ce={key:4,class:"bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200"},$e={class:"text-sm text-gray-700"},Be={class:"flex space-x-2"},Me=["disabled"],Se=["disabled"],Ae={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},je={class:"text-gray-600 mb-6"},Ne={class:"flex justify-end space-x-3"},Pe=q({__name:"index",setup(Te){const f=Y(),{accessToken:h}=J(),w=g([]),k=g(!1),v=g(""),m=g(!1),x=g(null),u=g(null),d=S({search:"",role:"",status:""}),a=S({page:1,limit:20,total:0,totalPages:0});let _=null;const D=()=>{_&&clearTimeout(_),_=setTimeout(()=>{a.page=1,p()},500)},p=async()=>{k.value=!0,v.value="";try{const s=new URLSearchParams({page:a.page.toString(),limit:a.limit.toString()});d.search&&s.append("search",d.search),d.role&&s.append("role",d.role),d.status&&s.append("status",d.status);const t=await $fetch(`${f.public.apiBase}/admin/users?${s.toString()}`,{headers:{Authorization:`Bearer ${h.value}`}});t.success&&(w.value=t.data,Object.assign(a,t.pagination))}catch(s){console.error("Error loading users:",s),v.value=s.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{k.value=!1}},$=s=>{a.page=s,p()},V=s=>{x.value={...s},m.value=!1},B=()=>{m.value=!1,x.value=null},E=()=>{B(),p()},M=async(s,t)=>{try{await $fetch(`${f.public.apiBase}/admin/users/${s}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${h.value}`},body:{status:t}}),await p()}catch(y){console.error("Error updating status:",y),alert(y.data?.message||"เกิดข้อผิดพลาดในการอัปเดตสถานะ")}},L=s=>{u.value=s},P=async()=>{if(u.value)try{await $fetch(`${f.public.apiBase}/admin/users/${u.value.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${h.value}`}}),u.value=null,await p()}catch(s){console.error("Error deleting user:",s),alert(s.data?.message||"เกิดข้อผิดพลาดในการลบผู้ใช้งาน")}},z=s=>({system_admin:"System Admin",owner:"Owner",admin:"Admin กลาง",branch_admin:"Branch Admin",tutor:"อาจารย์",parent:"ผู้ปกครอง",student:"นักเรียน"})[s]||s,H=s=>({system_admin:"bg-purple-100 text-purple-800",owner:"bg-indigo-100 text-indigo-800",admin:"bg-teal-100 text-teal-800",branch_admin:"bg-blue-100 text-blue-800",tutor:"bg-green-100 text-green-800",parent:"bg-yellow-100 text-yellow-800",student:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",R=s=>({active:"ใช้งาน",inactive:"ปิดใช้งาน",suspended:"ระงับ"})[s]||s,O=s=>({active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",suspended:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",F=s=>Z(new Date(s),"dd MMM yyyy",{locale:ee});return G(()=>{p()}),(s,t)=>{const y=I;return r(),l("div",null,[e("div",te,[t[9]||(t[9]=e("h1",{class:"text-3xl font-bold"},"จัดการผู้ใช้งาน",-1)),e("button",{onClick:t[0]||(t[0]=n=>m.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...t[8]||(t[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มผู้ใช้งาน",-1)])])]),e("div",se,[e("div",oe,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>o(d).search=n),type:"text",placeholder:"ค้นหาด้วย username, email, ชื่อ",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:D},null,544),[[Q,o(d).search]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"บทบาท",-1)),C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>o(d).role=n),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:p},[...t[11]||(t[11]=[W('<option value="">ทั้งหมด</option><option value="system_admin">System Admin</option><option value="owner">Owner</option><option value="admin">Admin กลาง</option><option value="branch_admin">Branch Admin</option><option value="tutor">Tutor</option><option value="parent">Parent</option><option value="student">Student</option>',8)])],544),[[A,o(d).role]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะ",-1)),C(e("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>o(d).status=n),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onChange:p},[...t[13]||(t[13]=[e("option",{value:""},"ทั้งหมด",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"suspended"},"Suspended",-1)])],544),[[A,o(d).status]])])])]),e("div",ne,[o(k)?(r(),l("div",ae,[...t[15]||(t[15]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):o(v)?(r(),l("div",re,i(o(v)),1)):o(w).length===0?(r(),l("div",le," ไม่พบผู้ใช้งาน ")):(r(),l("table",ie,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ผู้ใช้งาน"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"บทบาท"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สถานะ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"วันที่สร้าง"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",de,[(r(!0),l(j,null,N(o(w),n=>(r(),l("tr",{key:n.id,class:"hover:bg-gray-50"},[e("td",ue,[e("div",null,[e("div",pe,i(n.first_name)+" "+i(n.last_name),1),e("div",ce,i(n.username),1),n.email?(r(),l("div",ge,i(n.email),1)):b("",!0)])]),e("td",me,[e("div",xe,[(r(!0),l(j,null,N(n.roles,c=>(r(),l("span",{key:c,class:U(["px-2 py-1 text-xs font-medium rounded",H(c)])},i(z(c)),3))),128))])]),e("td",ve,[e("span",{class:U(["px-2 py-1 text-xs font-medium rounded",O(n.status)])},i(R(n.status)),3)]),e("td",ye,i(F(n.created_at)),1),e("td",be,[e("div",fe,[e("button",{onClick:c=>V(n),class:"text-blue-600 hover:text-blue-900",title:"แก้ไข"},[...t[16]||(t[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,he),n.status==="active"?(r(),l("button",{key:0,onClick:c=>M(n.id,"inactive"),class:"text-yellow-600 hover:text-yellow-900",title:"ปิดใช้งาน"},[...t[17]||(t[17]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1)])],8,we)):(r(),l("button",{key:1,onClick:c=>M(n.id,"active"),class:"text-green-600 hover:text-green-900",title:"เปิดใช้งาน"},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,ke)),e("button",{onClick:c=>L(n),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...t[19]||(t[19]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_e)])])]))),128))])])),o(a).totalPages>1?(r(),l("div",Ce,[e("div",$e," แสดง "+i((o(a).page-1)*o(a).limit+1)+" ถึง "+i(Math.min(o(a).page*o(a).limit,o(a).total))+" จาก "+i(o(a).total)+" รายการ ",1),e("div",Be,[e("button",{onClick:t[4]||(t[4]=n=>$(o(a).page-1)),disabled:o(a).page===1,class:"px-3 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"}," ก่อนหน้า ",8,Me),e("button",{onClick:t[5]||(t[5]=n=>$(o(a).page+1)),disabled:o(a).page>=o(a).totalPages,class:"px-3 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"}," ถัดไป ",8,Se)])])):b("",!0)]),o(m)||o(x)?(r(),K(y,{key:0,show:o(m)||!!o(x),user:o(x),onClose:B,onSaved:E},null,8,["show","user"])):b("",!0),o(u)?(r(),l("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[7]||(t[7]=X(n=>u.value=null,["self"]))},[e("div",Ae,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold mb-4"},"ยืนยันการลบ",-1)),e("p",je,[t[21]||(t[21]=T(" คุณแน่ใจหรือไม่ว่าต้องการลบผู้ใช้งาน ",-1)),e("strong",null,i(o(u).first_name)+" "+i(o(u).last_name),1),t[22]||(t[22]=T("? ",-1)),t[23]||(t[23]=e("br",null,null,-1)),t[24]||(t[24]=e("span",{class:"text-sm text-red-600"},"การกระทำนี้ไม่สามารถยกเลิกได้",-1))]),e("div",Ne,[e("button",{onClick:t[6]||(t[6]=n=>u.value=null),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{onClick:P,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"}," ลบ ")])])])):b("",!0)])}}});export{Pe as default};
