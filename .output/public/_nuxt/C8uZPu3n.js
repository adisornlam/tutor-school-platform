import{_ as j}from"./0JwXLbdW.js";import{d as I,m as z,l as A,B as V,r as d,o as N,c as r,b as e,v as m,f as E,w as H,t as n,e as s,F as R,i as D,s as F,j as L,a as l,n as w}from"./CX4WDIMJ.js";import{f as T}from"./BALXvQ8s.js";import{t as O}from"./CiM0_A9B.js";const P={class:"flex items-center justify-between mb-6"},q={class:"flex items-center space-x-4"},G={class:"text-3xl font-bold"},J={key:0,class:"text-center py-12"},K={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6"},Q={key:2,class:"h-[calc(100vh-200px)] flex flex-col bg-white rounded-lg shadow"},S={class:"border-b p-4 bg-gray-50"},U={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},W={class:"font-semibold"},X={class:"font-semibold"},Y={class:"font-semibold"},Z={class:"flex-1 overflow-y-auto p-4 space-y-1"},ee={key:0,class:"text-center py-2 text-sm text-gray-500"},te={key:1,class:"text-center py-2"},se={class:"flex space-x-2 max-w-[70%]"},oe={key:0,class:"whitespace-pre-wrap"},ae=["src","onClick"],re=["href"],le={class:"text-xs opacity-75 mt-1"},ne=["src"],pe=I({__name:"[roomId]",setup(ie){const C=z(),g=L(),{accessToken:b}=A(),x=V(()=>parseInt(C.params.roomId)),i=d(null),f=d([]),h=d(!0),u=d(!1),p=d(""),_=d(null),y=d(0),v=d(!0),M=async()=>{h.value=!0,p.value="";try{const a=await $fetch(`${g.public.apiBase}/admin/chat/rooms/${x.value}`,{headers:{Authorization:`Bearer ${b.value}`}});a.success&&(i.value=a.data,await k())}catch(a){p.value=a.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล",console.error("[Admin Chat] Error loading room:",a)}finally{h.value=!1}},k=async(a=!1)=>{u.value=!0;try{const t=a?y.value:0,c=await $fetch(`${g.public.apiBase}/chat/rooms/${x.value}/messages?limit=50&offset=${t}`,{headers:{Authorization:`Bearer ${b.value}`}});c.success&&(a?f.value=[...c.data.reverse(),...f.value]:(f.value=c.data.reverse(),y.value=0),c.data.length<50?v.value=!1:(y.value+=c.data.length,v.value=!0))}catch(t){console.error("[Admin Chat] Error loading messages:",t)}finally{u.value=!1}},$=()=>{!v.value||u.value||k(!0)},B=a=>{try{return T(new Date(a),"dd/MM/yyyy HH:mm",{locale:O})}catch{return a}};return N(()=>{M()}),(a,t)=>{const c=j;return l(),r("div",null,[e("div",P,[e("div",q,[E(c,{to:"/admin/chat",class:"p-2 hover:bg-gray-100 rounded-lg"},{default:H(()=>[...t[2]||(t[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),e("h1",G,"ดูแชท #"+n(s(x)),1)])]),s(h)?(l(),r("div",J,[...t[3]||(t[3]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-4 text-gray-600"},"กำลังโหลดข้อมูล...",-1)])])):s(p)?(l(),r("div",K,n(s(p)),1)):s(i)?(l(),r("div",Q,[e("div",S,[e("div",U,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-sm text-gray-500"},"ผู้เรียน",-1)),e("p",W,n(s(i).student?.first_name)+" "+n(s(i).student?.last_name),1)]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-500"},"อาจารย์",-1)),e("p",X,n(s(i).tutor?.first_name)+" "+n(s(i).tutor?.last_name),1)]),e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-500"},"คอร์ส",-1)),e("p",Y,n(s(i).course?.title),1)])])]),e("div",Z,[s(u)?(l(),r("div",ee," กำลังโหลด... ")):m("",!0),s(v)&&!s(u)?(l(),r("div",te,[e("button",{onClick:$,class:"text-sm text-green-600 hover:text-green-700 font-medium"}," โหลดข้อความเก่า ")])):m("",!0),(l(!0),r(R,null,D(s(f),o=>(l(),r("div",{key:o.id,class:w(["flex mb-4",o.sender_id===s(i).student_id?"justify-end":"justify-start"])},[e("div",se,[e("div",{class:w(["rounded-lg px-4 py-2",o.sender_id===s(i).student_id?"bg-green-600 text-white":"bg-gray-100 text-gray-900"])},[o.message_type==="text"?(l(),r("p",oe,n(o.content),1)):o.message_type==="image"&&o.file_url?(l(),r("img",{key:1,src:o.file_url,alt:"Image",class:"rounded-lg max-w-sm cursor-pointer",onClick:de=>_.value=o.file_url},null,8,ae)):o.message_type==="file"&&o.file_url?(l(),r("a",{key:2,href:o.file_url,target:"_blank",class:"flex items-center space-x-2 text-sm hover:underline"},[t[7]||(t[7]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",null,n(o.file_name||"ไฟล์"),1)],8,re)):m("",!0),e("p",le,n(B(o.created_at)),1)],2)])],2))),128))])])):m("",!0),s(_)?(l(),r("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:t[1]||(t[1]=o=>_.value=null)},[e("img",{src:s(_),alt:"Preview",class:"max-w-full max-h-full object-contain",onClick:t[0]||(t[0]=F(()=>{},["stop"]))},null,8,ne)])):m("",!0)])}}});export{pe as default};
