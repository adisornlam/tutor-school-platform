import{d as j,l as R,q as S,r as x,E as H,c as d,v as b,b as e,t as h,s as $,x as C,g as N,y as M,e as n,n as E,a as i,j as z,o as P,k as q,F,i as O,M as I}from"./B_rLn4hw.js";import{f as G}from"./BALXvQ8s.js";import{t as J}from"./CiM0_A9B.js";const K={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Q={class:"flex items-center justify-between mb-6"},W={class:"text-2xl font-bold"},X=["disabled"],Y={key:0,class:"mt-1 text-xs text-gray-500"},Z={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},ee={class:"flex justify-end space-x-3 pt-4"},te=["disabled"],se={key:0},oe={key:1},ne=j({__name:"RoleModal",props:{show:{type:Boolean},role:{default:null}},emits:["close","saved"],setup(p,{emit:w}){const f=p,y=w,v=z(),{accessToken:g}=R(),a=S({name:"",description:""}),c=x(!1),u=x("");H(()=>f.role,s=>{s?(a.name=s.name,a.description=s.description||""):(a.name="",a.description=""),u.value=""},{immediate:!0});const _=async()=>{c.value=!0,u.value="";try{const s={name:a.name,description:a.description||null};f.role?(s.name=void 0,await $fetch(`${v.public.apiBase}/admin/settings/roles/${f.role.id}`,{method:"PUT",headers:{Authorization:`Bearer ${g.value}`},body:{description:s.description}})):await $fetch(`${v.public.apiBase}/admin/settings/roles`,{method:"POST",headers:{Authorization:`Bearer ${g.value}`},body:s}),y("saved"),y("close")}catch(s){console.error("Error saving role:",s),u.value=s.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{c.value=!1}};return(s,o)=>p.show?(i(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:o[4]||(o[4]=$(m=>s.$emit("close"),["self"]))},[e("div",K,[e("div",Q,[e("h2",W,h(p.role?"แก้ไขบทบาท":"เพิ่มบทบาท"),1),e("button",{onClick:o[0]||(o[0]=m=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...o[5]||(o[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$(_,["prevent"]),class:"space-y-4"},[e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[N(" ชื่อบทบาท "),e("span",{class:"text-red-500"},"*")],-1)),C(e("input",{"onUpdate:modelValue":o[1]||(o[1]=m=>n(a).name=m),type:"text",required:"",disabled:!!p.role,class:E(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",{"bg-gray-100 cursor-not-allowed":p.role}])},null,10,X),[[M,n(a).name]]),p.role?(i(),d("p",Y,"ไม่สามารถแก้ไขชื่อบทบาทระบบได้")):b("",!0)]),e("div",null,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," คำอธิบาย ",-1)),C(e("textarea",{"onUpdate:modelValue":o[2]||(o[2]=m=>n(a).description=m),rows:"3",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[M,n(a).description]])]),n(u)?(i(),d("div",Z,h(n(u)),1)):b("",!0),e("div",ee,[e("button",{type:"button",onClick:o[3]||(o[3]=m=>s.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:n(c),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[n(c)?(i(),d("span",se,"กำลังบันทึก...")):(i(),d("span",oe,"บันทึก"))],8,te)])],32)])])):b("",!0)}}),re=Object.assign(ne,{__name:"RoleModal"}),ae={class:"flex items-center justify-between mb-6"},le={class:"bg-white rounded-lg shadow p-4 mb-6"},ie={class:"bg-white rounded-lg shadow overflow-hidden"},de={key:0,class:"p-8 text-center"},ce={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},ue={key:2,class:"p-8 text-center text-gray-500"},me={key:3,class:"min-w-full divide-y divide-gray-200"},pe={class:"bg-white divide-y divide-gray-200"},ge={class:"px-6 py-4 whitespace-nowrap"},xe={class:"text-sm font-medium text-gray-900"},fe={class:"px-6 py-4"},ye={class:"text-sm text-gray-500 max-w-xs truncate"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},he={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},be={class:"flex items-center justify-end space-x-2"},we=["onClick","disabled"],ke=["onClick"],Me=j({__name:"index",setup(p){const w=z(),{accessToken:f}=R(),y=x([]),v=x(!1),g=x(""),a=x(!1),c=x(null),u=S({search:""}),_=["system_admin","owner","admin","branch_admin","tutor","parent","student"],s=r=>_.includes(r);let o=null;const m=()=>{o&&clearTimeout(o),o=setTimeout(()=>{k()},500)},k=async()=>{v.value=!0,g.value="";try{const r=new URLSearchParams;u.search&&r.append("search",u.search);const t=await $fetch(`${w.public.apiBase}/admin/settings/roles?${r.toString()}`,{headers:{Authorization:`Bearer ${f.value}`}});t.success&&(y.value=t.data)}catch(r){console.error("Error loading roles:",r),g.value=r.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{v.value=!1}},V=r=>{s(r.name)||(c.value={...r},a.value=!1)},B=()=>{a.value=!1,c.value=null},A=()=>{B(),k()},D=async r=>{if(s(r.name))return;const{confirm:t}=I();if(await t({title:"ยืนยันการลบ",message:`คุณแน่ใจหรือไม่ว่าต้องการลบบทบาท ${r.name}?
การกระทำนี้ไม่สามารถยกเลิกได้`,confirmText:"ลบ",cancelText:"ยกเลิก",type:"danger"}))try{await $fetch(`${w.public.apiBase}/admin/settings/roles/${r.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${f.value}`}}),await k()}catch(l){console.error("Error deleting role:",l),alert(l.data?.message||"เกิดข้อผิดพลาดในการลบบทบาท")}},L=r=>G(new Date(r),"dd MMM yyyy",{locale:J});return P(()=>{k()}),(r,t)=>{const T=re;return i(),d("div",null,[e("div",ae,[t[3]||(t[3]=e("h1",{class:"text-3xl font-bold"},"จัดการบทบาทผู้ใช้",-1)),e("button",{onClick:t[0]||(t[0]=l=>a.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มบทบาท",-1)])])]),e("div",le,[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>n(u).search=l),type:"text",placeholder:"ค้นหาด้วยชื่อบทบาท, คำอธิบาย",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:m},null,544),[[M,n(u).search]])])]),e("div",ie,[n(v)?(i(),d("div",de,[...t[5]||(t[5]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):n(g)?(i(),d("div",ce,h(n(g)),1)):n(y).length===0?(i(),d("div",ue," ไม่พบบทบาท ")):(i(),d("table",me,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ชื่อบทบาท"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"คำอธิบาย"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"วันที่สร้าง"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",pe,[(i(!0),d(F,null,O(n(y),l=>(i(),d("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",ge,[e("div",xe,h(l.name),1)]),e("td",fe,[e("div",ye,h(l.description||"-"),1)]),e("td",ve,h(L(l.created_at)),1),e("td",he,[e("div",be,[e("button",{onClick:$(U=>V(l),["stop"]),class:"text-blue-600 hover:text-blue-900",title:"แก้ไข",disabled:s(l.name)},[(i(),d("svg",{class:E(["w-5 h-5",{"opacity-50 cursor-not-allowed":s(l.name)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"},null,-1)])],2))],8,we),s(l.name)?b("",!0):(i(),d("button",{key:0,onClick:$(U=>D(l),["stop"]),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ke))])])]))),128))])]))]),n(a)||n(c)?(i(),q(T,{key:0,show:n(a)||!!n(c),role:n(c),onClose:B,onSaved:A},null,8,["show","role"])):b("",!0)])}}});export{Me as default};
