import{d as M,l as T,q as V,r as g,E as L,c,v as j,b as e,t as x,s as $,x as v,g as S,y as h,e as o,a as i,j as E,o as D,k as H,F as q,i as N,M as P}from"./B_rLn4hw.js";const F={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},I={class:"flex items-center justify-between mb-6"},O={class:"text-2xl font-bold"},R={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},G={class:"md:col-span-2"},J={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},K={class:"flex justify-end space-x-3 pt-4"},Q=["disabled"],W={key:0},X={key:1},Y=M({__name:"SubjectModal",props:{show:{type:Boolean},subject:{default:null}},emits:["close","saved"],setup(k,{emit:_}){const f=k,b=_,y=E(),{accessToken:m}=T(),s=V({code:"",name:"",short_name:"",description:"",icon:""}),u=g(!1),p=g("");L(()=>f.subject,r=>{r?(s.code=r.code,s.name=r.name,s.short_name=r.short_name||"",s.description=r.description||"",s.icon=r.icon||""):(s.code="",s.name="",s.short_name="",s.description="",s.icon=""),p.value=""},{immediate:!0});const w=async()=>{u.value=!0,p.value="";try{const r={code:s.code,name:s.name,short_name:s.short_name||null,description:s.description||null,icon:s.icon||null};f.subject?await $fetch(`${y.public.apiBase}/admin/settings/subjects/${f.subject.id}`,{method:"PUT",headers:{Authorization:`Bearer ${m.value}`},body:r}):await $fetch(`${y.public.apiBase}/admin/settings/subjects`,{method:"POST",headers:{Authorization:`Bearer ${m.value}`},body:r}),b("saved"),b("close")}catch(r){console.error("Error saving subject:",r),p.value=r.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{u.value=!1}};return(r,t)=>k.show?(i(),c("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[7]||(t[7]=$(l=>r.$emit("close"),["self"]))},[e("div",F,[e("div",I,[e("h2",O,x(k.subject?"แก้ไขวิชา":"เพิ่มวิชา"),1),e("button",{onClick:t[0]||(t[0]=l=>r.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...t[8]||(t[8]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$(w,["prevent"]),class:"space-y-4"},[e("div",R,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[S(" รหัส "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o(s).code=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[h,o(s).code]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[S(" ชื่อวิชา "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o(s).name=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[h,o(s).name]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ชื่อย่อ ",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>o(s).short_name=l),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[h,o(s).short_name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ไอคอน (Icon) ",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>o(s).icon=l),type:"text",placeholder:"เช่น: book, calculator",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[h,o(s).icon]])]),e("div",G,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," รายละเอียด ",-1)),v(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=l=>o(s).description=l),rows:"3",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[h,o(s).description]])])]),o(p)?(i(),c("div",J,x(o(p)),1)):j("",!0),e("div",K,[e("button",{type:"button",onClick:t[6]||(t[6]=l=>r.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:o(u),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[o(u)?(i(),c("span",W,"กำลังบันทึก...")):(i(),c("span",X,"บันทึก"))],8,Q)])],32)])])):j("",!0)}}),Z=Object.assign(Y,{__name:"SubjectModal"}),ee={class:"flex items-center justify-between mb-6"},te={class:"bg-white rounded-lg shadow p-4 mb-6"},se={class:"bg-white rounded-lg shadow overflow-hidden"},oe={key:0,class:"p-8 text-center"},ne={key:1,class:"p-4 bg-red-50 border border-red-200 text-red-700 rounded"},re={key:2,class:"p-8 text-center text-gray-500"},le={key:3,class:"min-w-full divide-y divide-gray-200"},ae={class:"bg-white divide-y divide-gray-200"},ie={class:"px-6 py-4 whitespace-nowrap"},de={class:"text-sm font-medium text-gray-900"},ce={class:"px-6 py-4 whitespace-nowrap"},ue={class:"text-sm text-gray-900"},pe={class:"px-6 py-4 whitespace-nowrap"},me={class:"text-sm text-gray-500"},ge={class:"px-6 py-4"},xe={class:"text-sm text-gray-500 max-w-xs truncate"},fe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},be={class:"flex items-center justify-end space-x-2"},ye=["onClick"],ve=["onClick"],we=M({__name:"index",setup(k){const _=E(),{accessToken:f}=T(),b=g([]),y=g(!1),m=g(""),s=g(!1),u=g(null),p=V({search:""});let w=null;const r=()=>{w&&clearTimeout(w),w=setTimeout(()=>{t()},500)},t=async()=>{y.value=!0,m.value="";try{const d=new URLSearchParams;p.search&&d.append("search",p.search);const n=await $fetch(`${_.public.apiBase}/admin/settings/subjects?${d.toString()}`,{headers:{Authorization:`Bearer ${f.value}`}});n.success&&(b.value=n.data)}catch(d){console.error("Error loading subjects:",d),m.value=d.data?.message||"เกิดข้อผิดพลาดในการโหลดข้อมูล"}finally{y.value=!1}},l=d=>{u.value={...d},s.value=!1},C=()=>{s.value=!1,u.value=null},U=()=>{C(),t()},z=async d=>{const{confirm:n}=P();if(await n({title:"ยืนยันการลบ",message:`คุณแน่ใจหรือไม่ว่าต้องการลบวิชา ${d.name}?
การกระทำนี้ไม่สามารถยกเลิกได้`,confirmText:"ลบ",cancelText:"ยกเลิก",type:"danger"}))try{await $fetch(`${_.public.apiBase}/admin/settings/subjects/${d.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${f.value}`}}),await t()}catch(a){console.error("Error deleting subject:",a),alert(a.data?.message||"เกิดข้อผิดพลาดในการลบวิชา")}};return D(()=>{t()}),(d,n)=>{const B=Z;return i(),c("div",null,[e("div",ee,[n[3]||(n[3]=e("h1",{class:"text-3xl font-bold"},"จัดการวิชา",-1)),e("button",{onClick:n[0]||(n[0]=a=>s.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"},[...n[2]||(n[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"เพิ่มวิชา",-1)])])]),e("div",te,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ค้นหา",-1)),v(e("input",{"onUpdate:modelValue":n[1]||(n[1]=a=>o(p).search=a),type:"text",placeholder:"ค้นหาด้วยชื่อวิชา, รหัส, ชื่อย่อ",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",onInput:r},null,544),[[h,o(p).search]])])]),e("div",se,[o(y)?(i(),c("div",oe,[...n[5]||(n[5]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"กำลังโหลด...",-1)])])):o(m)?(i(),c("div",ne,x(o(m)),1)):o(b).length===0?(i(),c("div",re," ไม่พบวิชา ")):(i(),c("table",le,[n[8]||(n[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"รหัส"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ชื่อวิชา"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ชื่อย่อ"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"รายละเอียด"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),e("tbody",ae,[(i(!0),c(q,null,N(o(b),a=>(i(),c("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",ie,[e("div",de,x(a.code),1)]),e("td",ce,[e("div",ue,x(a.name),1)]),e("td",pe,[e("div",me,x(a.short_name||"-"),1)]),e("td",ge,[e("div",xe,x(a.description||"-"),1)]),e("td",fe,[e("div",be,[e("button",{onClick:$(A=>l(a),["stop"]),class:"text-blue-600 hover:text-blue-900",title:"แก้ไข"},[...n[6]||(n[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ye),e("button",{onClick:$(A=>z(a),["stop"]),class:"text-red-600 hover:text-red-900",title:"ลบ"},[...n[7]||(n[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ve)])])]))),128))])]))]),o(s)||o(u)?(i(),H(B,{key:0,show:o(s)||!!o(u),subject:o(u),onClose:C,onSaved:U},null,8,["show","subject"])):j("",!0)])}}});export{we as default};
