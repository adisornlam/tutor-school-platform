import{d as V,l as E,r as g,q,E as w,B as U,c as d,v as k,b as e,t as m,e as o,F as _,i as D,s as h,x as y,g as c,y as x,a,j as N}from"./B_rLn4hw.js";const S={class:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto"},z={class:"flex items-center justify-between mb-6"},A={class:"text-2xl font-bold"},F={key:0},R={class:"space-y-4"},P={class:"px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg"},G={class:"px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg"},I={class:"px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg"},J={class:"flex flex-wrap gap-2"},K={class:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg min-h-[200px] overflow-auto"},O=["innerHTML"],Q={class:"px-4 py-3 bg-white border-2 border-gray-300 rounded-lg min-h-[200px]"},W=["innerHTML"],X={class:"flex justify-end space-x-3 pt-6 mt-6 border-t"},Y=["value"],Z={class:"px-4 py-3 bg-white border-2 border-gray-300 rounded-lg min-h-[200px]"},ee=["innerHTML"],te={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},se={class:"flex justify-end space-x-3 pt-4"},oe=["disabled"],le={key:0},ne={key:1},re="<p>สวัสดี {{first_name}},</p>",ae=V({__name:"TemplateModal",props:{show:{type:Boolean},template:{},mode:{default:"view"}},emits:["close","saved"],setup(r,{emit:T}){const i=r,v=T,j=N(),{accessToken:M}=E(),u=g(i.mode),$=()=>{u.value="edit"},L=()=>{u.value="view"},l=q({name:"",subject:"",body:""}),p=g(!1),b=g(""),B=s=>`{{${s}}}`;w(()=>i.template,s=>{s&&(l.name=s.name,l.subject=s.subject,l.body=s.body),b.value="",u.value=i.mode},{immediate:!0}),w(()=>i.mode,s=>{u.value=s});const f=U(()=>{let s=l.body||i.template.body;return i.template.variables.forEach(t=>{const n={first_name:"สมชาย",last_name:"ใจดี",email:"example@email.com",student_name:"สมชาย ใจดี",course_name:"คณิตศาสตร์ ม.3",enrollment_date:"1 มกราคม 2567",reset_link:"https://example.com/reset-password"},H=new RegExp(`{{\\s*${t}\\s*}}`,"g");s=s.replace(H,n[t]||`[${t}]`)}),s}),C=async()=>{p.value=!0,b.value="";try{await $fetch(`${j.public.apiBase}/admin/settings/email/templates/${i.template.id}`,{method:"PUT",headers:{Authorization:`Bearer ${M.value}`},body:{name:l.name,subject:l.subject,body:l.body}}),v("saved"),v("close")}catch(s){console.error("Error saving template:",s),b.value=s.data?.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}finally{p.value=!1}};return(s,t)=>r.show?(a(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[5]||(t[5]=h(n=>s.$emit("close"),["self"]))},[e("div",S,[e("div",z,[e("h2",A,m(o(u)==="view"?"ดูเทมเพลต":"แก้ไขเทมเพลต"),1),e("button",{onClick:t[0]||(t[0]=n=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...t[6]||(t[6]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),o(u)==="view"?(a(),d("div",F,[e("div",R,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ชื่อเทมเพลต",-1)),e("div",P,m(r.template.name),1)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"รหัส",-1)),e("div",G,m(r.template.code),1)]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"หัวเรื่อง",-1)),e("div",I,m(r.template.subject),1)]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ตัวแปรที่ใช้ได้",-1)),e("div",J,[(a(!0),d(_,null,D(r.template.variables,n=>(a(),d("span",{key:n,class:"px-3 py-1 text-sm font-medium bg-blue-100 text-blue-800 rounded"},m(B(n)),1))),128))])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"เนื้อหา (HTML)",-1)),e("div",K,[e("div",{innerHTML:r.template.body},null,8,O)])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ตัวอย่างการแสดงผล",-1)),e("div",Q,[e("div",{innerHTML:o(f)},null,8,W)])])]),e("div",X,[e("button",{type:"button",onClick:t[1]||(t[1]=n=>s.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ปิด "),e("button",{type:"button",onClick:$,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"}," แก้ไข ")])])):(a(),d("form",{key:1,onSubmit:h(C,["prevent"]),class:"space-y-4"},[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" ชื่อเทมเพลต "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>o(l).name=n),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[x,o(l).name]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"รหัส",-1)),e("input",{value:r.template.code,type:"text",disabled:"",class:"w-full px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg cursor-not-allowed"},null,8,Y)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" หัวเรื่อง "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>o(l).subject=n),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[x,o(l).subject]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" เนื้อหา (HTML) "),e("span",{class:"text-red-500"},"*")],-1)),y(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=n=>o(l).body=n),rows:"10",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 font-mono text-sm",placeholder:re},null,512),[[x,o(l).body]]),t[17]||(t[17]=e("p",{class:"mt-1 text-xs text-gray-500"},"ใช้ตัวแปรในรูปแบบ {{variable_name}}",-1))]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ตัวอย่างการแสดงผล",-1)),e("div",Z,[e("div",{innerHTML:o(f)},null,8,ee)])]),o(b)?(a(),d("div",te,m(o(b)),1)):k("",!0),e("div",se,[e("button",{type:"button",onClick:L,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100"}," ยกเลิก "),e("button",{type:"submit",disabled:o(p),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[o(p)?(a(),d("span",le,"กำลังบันทึก...")):(a(),d("span",ne,"บันทึก"))],8,oe)])],32))])])):k("",!0)}});export{ae as _};
